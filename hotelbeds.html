<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Pesquisa de Parques Temáticos - Exemplo Hotelbeds Activities</title>
  <!-- Biblioteca para gerar a assinatura SHA-256 (CryptoJS) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    /* ==== CSS para evitar conflitos e estilizar o formulário ==== */
    #search-container {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ccc;
    }
    #search-container h2 {
      margin-bottom: 15px;
    }
    .search-row {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .search-row label {
      width: 100%;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .search-row input[type="text"],
    .search-row input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 5px;
      box-sizing: border-box;
    }
    .radio-row {
      display: flex;
      gap: 15px;
      margin-bottom: 10px;
    }
    .radio-row label {
      font-weight: normal;
    }
    button {
      padding: 10px 15px;
      font-size: 1rem;
      background-color: #a20033; /* cor semelhante à do botão "Pesquisar" */
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #b3003b;
    }
    #results {
      margin-top: 20px;
      white-space: pre-wrap;
      background-color: #f7f7f7;
      border: 1px solid #ccc;
      padding: 10px;
    }
  </style>
</head>
<body>

<div id="search-container">
  <h2>Pesquisa de Parques Temáticos</h2>
  
  <!-- Radio buttons para escolher tipo de produto (exemplo didático) -->
  <div class="radio-row">
    <div>
      <input 
        type="radio" 
        name="ticketOption" 
        id="onlyTicket" 
        value="APENAS_BILHETE" 
        checked
      />
      <label for="onlyTicket">Apenas bilhete</label>
    </div>
    <div>
      <input 
        type="radio" 
        name="ticketOption" 
        id="hotelPackage" 
        value="HOTEL_PACOTE"
      />
      <label for="hotelPackage">Hotel/pacotes</label>
    </div>
  </div>

  <!-- Campo de destino/parque temático -->
  <div class="search-row">
    <label for="destinationInput">Destino ou parque temático <span style="color:red">*</span></label>
    <input 
      type="text" 
      id="destinationInput" 
      placeholder="Por exemplo: Barcelona, Espanha" 
      required
    />
  </div>

  <!-- Datas "de" e "até" (opcional) -->
  <div class="search-row">
    <div style="width: 48%; margin-right: 4%;">
      <label for="fromDate">Desde (opcional)</label>
      <input 
        type="date" 
        id="fromDate"
      />
    </div>
    <div style="width: 48%;">
      <label for="toDate">Até (opcional)</label>
      <input 
        type="date" 
        id="toDate"
      />
    </div>
  </div>

  <button type="button" onclick="searchActivities()">
    Pesquisar
  </button>

  <!-- Div para mostrar a resposta da requisição -->
  <div id="results">A resposta da API aparecerá aqui.</div>
</div>

<script>
  /**
   * Exemplo de chamada à API "Activities" da Hotelbeds, usando o que o usuário
   * preencher nos campos do formulário (destino, datas, tipo etc.).
   */
  function searchActivities() {
    // 1) Obter valores dos campos
    var ticketOption = document.querySelector('input[name="ticketOption"]:checked').value;
    var destination = document.getElementById("destinationInput").value.trim();
    var fromDate = document.getElementById("fromDate").value; // YYYY-MM-DD
    var toDate = document.getElementById("toDate").value;     // YYYY-MM-DD

    // Validação simples: destino é obrigatório
    if (!destination) {
      alert("Por favor, informe um destino ou parque temático.");
      return;
    }

    // 2) Suas credenciais de teste da Hotelbeds (NÃO USAR EM PRODUÇÃO DIRETAMENTE!)
    var apiKey = "995c89cbb1766da1785cfb394a630747";
    var secret = "38ce721d98";

    // 3) Montar a assinatura X-Signature
    var timestamp = Math.floor(Date.now() / 1000);
    var signatureString = apiKey + secret + timestamp;
    var signature = CryptoJS.SHA256(signatureString).toString();

    // 4) Montar a URL de consulta
    // Exemplo de endpoint de teste:
    var endpoint = "https://api.test.hotelbeds.com/activity-api/3.0/activities";

    // Parâmetros obrigatórios:
    // - destination (ex. "BCN" para Barcelona) 
    // - datas (opcionais aqui, se estiverem vazias, não enviamos)
    // - language (ex.: "ENG" ou "PT")

    // ATENÇÃO: a API de Activities costuma trabalhar com códigos de destino (ex. "BCN"),
    // mas aqui vamos simular enviando a string do input. Na prática, você pode precisar
    // de um "destination converter" ou trabalhar com "geolocalização".

    // Vamos tratar as datas: se não preenchidas, não adicionamos no query param.
    // Se estiverem preenchidas, vamos converter para AAAA-MM-DD, se necessário.

    var queryParams = "?";
    queryParams += "destination=" + encodeURIComponent(destination);
    // Caso você queira forçar datas, adicione:
    if (fromDate) {
      queryParams += "&from=" + fromDate;
    }
    if (toDate) {
      queryParams += "&to=" + toDate;
    }
    // Idioma
    queryParams += "&language=ENG";
    queryParams += "&useSecondaryLanguage=false";

    // Monta a URL final
    var url = endpoint + queryParams;

    // 5) Configuração do fetch
    var options = {
      method: "GET",
      headers: {
        "Api-key": apiKey,
        "X-Signature": signature,
        "Accept": "application/json",
        "Accept-Encoding": "gzip"
      }
    };

    // (Opcional) Exibir algo para indicar que está carregando...
    document.getElementById("results").textContent = "Pesquisando atividades, aguarde...";

    // 6) Fazer a requisição
    fetch(url, options)
      .then(function(response) {
        // Verifica se a resposta está ok
        if (!response.ok) {
          throw new Error("HTTP status " + response.status);
        }
        return response.json();
      })
      .then(function(data) {
        console.log("Resposta da API:", data);
        // Mostrar no <div id="results">
        document.getElementById("results").textContent = JSON.stringify(data, null, 2);
      })
      .catch(function(error) {
        console.error("Erro na requisição:", error);
        document.getElementById("results").textContent = "Erro: " + error;
      });
  }
</script>

</body>
</html>
