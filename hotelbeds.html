<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Exemplo - Hotelbeds Activities Availability</title>
  <!-- Biblioteca para gerar assinatura SHA-256 (CryptoJS) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <style>
    /* ========== CSS para estilizar e evitar conflitos ========== */
    #availability-container {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      border: 1px solid #ccc;
    }
    #availability-container h2 {
      margin-bottom: 15px;
    }
    .field-group {
      margin-bottom: 10px;
    }
    .field-group label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    .field-group input[type="text"],
    .field-group input[type="date"],
    .field-group input[type="number"] {
      width: 100%;
      padding: 8px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 15px;
      font-size: 1rem;
      background-color: #a20033; /* cor semelhante aos exemplos anteriores */
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #b3003b;
    }
    #result-area {
      margin-top: 20px;
      white-space: pre-wrap;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
      padding: 10px;
      min-height: 100px;
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div id="availability-container">
  <h2>Pesquisa de Disponibilidade (Activities - Hotelbeds)</h2>

  <!-- Campo para o "Destination Code" (ex: MCO, BCN...) -->
  <div class="field-group">
    <label for="destination">Destino (código) <span style="color:red">*</span></label>
    <input 
      type="text" 
      id="destination" 
      placeholder="Ex: BCN (Barcelona), MCO (Orlando)..." 
      required 
    />
  </div>

  <!-- Datas obrigatórias (yyyy-mm-dd) -->
  <div class="field-group">
    <label for="fromDate">Data início (AAAA-MM-DD) <span style="color:red">*</span></label>
    <input 
      type="date" 
      id="fromDate" 
      required 
    />
  </div>

  <div class="field-group">
    <label for="toDate">Data fim (AAAA-MM-DD) <span style="color:red">*</span></label>
    <input 
      type="date" 
      id="toDate" 
      required
    />
  </div>

  <!-- Quantidade de pessoas (ex: 2 adultos, 1 criança etc.)
       Neste exemplo simples, vamos pegar só a idade do "primeiro passageiro".
       Você pode replicar ou adaptar para vários paxes. -->
  <div class="field-group">
    <label for="paxAge">Idade do Pax (ex: 30)</label>
    <input 
      type="number" 
      id="paxAge" 
      min="1" 
      value="30"
    />
  </div>

  <button type="button" onclick="searchAvailability()">
    Pesquisar
  </button>

  <div id="result-area">O resultado aparecerá aqui.</div>
</div>

<script>
  /**
   * Exemplo de função que faz POST no endpoint "/activities/availability"
   * da Hotelbeds, usando 'fetch' e incluindo a assinatura X-Signature.
   */
  function searchAvailability() {
    // 1) Captura valores do formulário:
    var destinationCode = document.getElementById("destination").value.trim();
    var fromDate = document.getElementById("fromDate").value;
    var toDate = document.getElementById("toDate").value;
    var paxAge = document.getElementById("paxAge").value || "30"; // se vazio, default 30

    // Simples validação:
    if (!destinationCode || !fromDate || !toDate) {
      alert("Por favor, preencha destino, data início e data fim.");
      return;
    }

    // 2) Credenciais de teste (NÃO expor em produção):
    var apiKey = "995c89cbb1766da1785cfb394a630747";
    var secret = "38ce721d98";

    // 3) Gera X-Signature: apiKey + secret + timestamp (em segundos)
    var timestamp = Math.floor(Date.now() / 1000);
    var signatureString = apiKey + secret + timestamp;
    var signature = CryptoJS.SHA256(signatureString).toString();

    // 4) Monta a URL do endpoint de teste:
    // Para o /activities/availability, usar environment test
    var endpoint = "https://api.test.hotelbeds.com/activity-api/3.0/activities/availability";

    // 5) Monta o JSON de request (exemplo básico com 'destination' e 'paxes'):
    // IMPORTANTE: datas devem estar no formato YYYY-MM-DD
    // "paxes" é um array, cada objeto precisa de { "age": number }
    // "filters": definimos "destination" => "BCN", "MCO", etc.
    // "from" e "to": datas obrigatórias
    // "language": ex: "en", "pt" etc.

    var requestBody = {
      filters: [
        {
          searchFilterItems: [
            {
              type: "destination", 
              value: destinationCode // ex: "BCN", "MCO"
            }
          ]
        }
      ],
      from: fromDate,            // ex: "2025-02-27"
      to: toDate,                // ex: "2025-03-02"
      paxes: [
        { age: Number(paxAge) }  // ex: { age: 30 }
      ],
      language: "en",
      pagination: {
        itemsPerPage: 10,
        page: 1
      },
      order: "DEFAULT"
    };

    // 6) Configura o fetch: POST + headers + body em JSON
    var fetchOptions = {
      method: "POST",
      headers: {
        "Api-key": apiKey,
        "X-Signature": signature,
        "Accept": "application/json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify(requestBody)
    };

    // 7) Limpar/indicar carregando
    var resultArea = document.getElementById("result-area");
    resultArea.textContent = "Carregando...";

    // 8) Executa a requisição
    fetch(endpoint, fetchOptions)
      .then(function(response) {
        if (!response.ok) {
          // Se status não estiver OK (200-299), lança erro para cair no catch
          throw new Error("HTTP error! Status: " + response.status);
        }
        return response.json();
      })
      .then(function(data) {
        console.log("Resposta da API:", data);
        // Exibe o JSON formatado
        resultArea.textContent = JSON.stringify(data, null, 2);
      })
      .catch(function(error) {
        console.error("Erro na requisição:", error);
        resultArea.innerHTML = '<span class="error">Erro: ' + error + '</span>';
      });
  }
</script>

</body>
</html>
