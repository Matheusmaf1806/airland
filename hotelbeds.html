<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Exemplo de Busca - Hotelbeds Activities API</title>

  <style>
    /* Estilos básicos para manter tudo isolado */
    #hotelbeds-activities-container {
      border: 2px solid #ccc;
      padding: 16px;
      max-width: 600px;
      margin: 0 auto;
      font-family: Arial, sans-serif;
    }
    #hotelbeds-activities-container h1 {
      font-size: 1.2rem;
      margin-bottom: 8px;
    }
    #hotelbeds-activities-container .button-container {
      margin-bottom: 16px;
    }
    #hotelbeds-activities-results {
      white-space: pre-wrap;
      background: #f9f9f9;
      padding: 10px;
      border: 1px solid #eee;
    }
  </style>
</head>
<body>
<div id="hotelbeds-activities-container">
  <h1>Exemplo de Busca de Atividades (Hotelbeds)</h1>
  
  <div class="button-container">
    <button id="searchButton">Fazer Busca</button>
  </div>

  <div id="hotelbeds-activities-results">Clique em "Fazer Busca" para ver o resultado aqui...</div>
</div>

<!-- Carrega CryptoJS sem integrity para evitar bloqueio -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js" referrerpolicy="no-referrer"></script>

<script>
(function(){
  // Credenciais e configurações da sua conta Hotelbeds
  const API_KEY    = "995c89cbb1766da1785cfb394a630747";
  const API_SECRET = "38ce721d98";
  const ACTIVITIES_SEARCH_URL = "https://api.test.hotelbeds.com/activities/v1/search";

  const btnSearch        = document.getElementById("searchButton");
  const resultsContainer = document.getElementById("hotelbeds-activities-results");

  btnSearch.addEventListener("click", async function() {
    const requestBody = {
      "filters": [{
        "searchFilterItems": [
          {
            "type": "destination",
            "value": "BCN"
          }
        ]
      }],
      "from": "2022-03-29",
      "to":   "2022-03-31"
    };

    // Gera a assinatura X-Signature
    const signature = generateSignature(API_KEY, API_SECRET);

    try {
      const response = await fetch(ACTIVITIES_SEARCH_URL, {
        method: "POST",
        headers: {
          "Api-key":      API_KEY,
          "X-Signature":  signature,
          "Content-Type": "application/json",
          "Accept":       "application/json"
        },
        body: JSON.stringify(requestBody)
      });

      if (!response.ok) {
        throw new Error("Erro de HTTP, status = " + response.status);
      }

      const data = await response.json();
      resultsContainer.textContent = JSON.stringify(data, null, 2);

    } catch (error) {
      console.error("Erro:", error);
      resultsContainer.textContent = "Ocorreu um erro: " + error.message;
    }
  });

  function generateSignature(apiKey, secret) {
    const timeStamp = Math.floor(Date.now() / 1000);
    const toSign    = apiKey + secret + timeStamp;
    return CryptoJS.MD5(toSign).toString();
  }
})();
</script>
</body>
</html>
