<div id="agency-auth-container">

  <style>
    #agency-auth-container {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #agency-auth-container h2 {
      margin-top: 1em;
    }
    .form-field {
      margin-bottom: 10px;
    }
    .form-field input {
      padding: 6px;
      width: 200px;
    }
    .btn {
      background: #007bff;
      color: #fff;
      padding: 6px 12px;
      border: none;
      cursor: pointer;
    }
    .btn:hover {
      background: #0056b3;
    }
    #response-area {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
    }
  </style>

  <h1>Cadastro e Login de Agências</h1>

  <!-- Form de Cadastro -->
  <div id="register-form">
    <h2>Cadastro de Agência</h2>
    <div class="form-field">
      <label>Nome:</label><br>
      <input type="text" id="reg-name">
    </div>
    <div class="form-field">
      <label>E-mail:</label><br>
      <input type="email" id="reg-email">
    </div>
    <div class="form-field">
      <label>Senha:</label><br>
      <input type="password" id="reg-password">
    </div>
    <button class="btn" id="btn-register">Cadastrar</button>
  </div>

  <!-- Form de Login -->
  <div id="login-form">
    <h2>Login de Agência</h2>
    <div class="form-field">
      <label>E-mail:</label><br>
      <input type="email" id="login-email">
    </div>
    <div class="form-field">
      <label>Senha:</label><br>
      <input type="password" id="login-password">
    </div>
    <button class="btn" id="btn-login">Login</button>
  </div>

  <!-- Área de Resposta / Token -->
  <div id="response-area">
    <p>Aqui aparecerão os resultados do cadastro e login.</p>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:3000/api'; // Ajuste conforme necessário

    const regNameEl = document.getElementById('reg-name');
    const regEmailEl = document.getElementById('reg-email');
    const regPasswordEl = document.getElementById('reg-password');
    const btnRegister = document.getElementById('btn-register');

    const loginEmailEl = document.getElementById('login-email');
    const loginPasswordEl = document.getElementById('login-password');
    const btnLogin = document.getElementById('btn-login');

    const responseArea = document.getElementById('response-area');

    // Evento de cadastro
    btnRegister.addEventListener('click', async () => {
      const name = regNameEl.value.trim();
      const email = regEmailEl.value.trim();
      const password = regPasswordEl.value.trim();

      if (!name || !email || !password) {
        alert('Preencha todos os campos para cadastrar.');
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/agencies/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, password })
        });

        if (!response.ok) {
          const errorData = await response.json();
          responseArea.innerHTML = `<p>Erro ao cadastrar agência: ${errorData.error || response.statusText}</p>`;
        } else {
          const data = await response.json();
          responseArea.innerHTML = `<p>Agência cadastrada com sucesso! Status: ${data.status}. Aguarde aprovação.</p>`;
        }
      } catch (error) {
        console.error(error);
        responseArea.innerHTML = '<p>Erro de conexão no cadastro.</p>';
      }
    });

    // Evento de login
    btnLogin.addEventListener('click', async () => {
      const email = loginEmailEl.value.trim();
      const password = loginPasswordEl.value.trim();

      if (!email || !password) {
        alert('Preencha email e senha para login.');
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (!response.ok) {
          responseArea.innerHTML = `<p>Erro no login: ${data.error || response.statusText}</p>`;
        } else {
          // Exibe token
          responseArea.innerHTML = `<p>Login OK! Token: <code>${data.token}</code></p>
                                    <p>Guarde este token para acessar rotas protegidas.</p>`;
        }
      } catch (error) {
        console.error(error);
        responseArea.innerHTML = '<p>Erro de conexão no login.</p>';
      }
    });
  </script>
</div>
