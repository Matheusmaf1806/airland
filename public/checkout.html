<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Checkout</title>

  <!-- Braintree Scripts (exceto Google Pay) -->
  <script src="https://js.braintreegateway.com/web/3.94.0/js/client.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.94.0/js/hosted-fields.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.94.0/js/three-d-secure.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.94.0/js/paypal-checkout.min.js"></script>

  <style>
    /* ===== FONT & RESET ===== */
    @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap");
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    html {
      scroll-behavior: smooth;
    }
    body {
      font-family: "Montserrat", sans-serif;
      font-weight: 400;
      color: #5d657b;
      background: #f1f5f9;
    }
    input, select, textarea {
      font-family: "Montserrat", sans-serif;
    }
    a:focus, input:focus, textarea:focus, button:focus {
      outline: none; box-shadow: none;
    }
    button, a {
      transition: all 0.3s ease-out;
      cursor: pointer;
    }

    /* ===== STEPS MENU ===== */
    .steps-menu {
      background-color: #365cf5;
      padding: 20px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 30px;
    }
    .steps-menu .step {
      display: flex; align-items: center; gap: 0.5rem;
      color: #fff; font-weight: 500; cursor: pointer;
    }
    .steps-menu .circle {
      width: 34px; height: 34px; border-radius: 50%;
      background-color: #fff; color: #365cf5;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700;
    }
    .steps-menu .separator {
      color: #fff; font-weight: bold;
    }
    .steps-menu .step.active .circle {
      background-color: #fff; color: #365cf5; border: 2px solid #fff;
    }
    .steps-menu .step.disabled {
      opacity: 0.6; cursor: not-allowed;
    }

    /* ===== MAIN LAYOUT ===== */
    .main-container {
      width: 90%; max-width: 1200px;
      margin: 2rem auto; display: flex; gap: 2rem;
    }
    .left-col { flex: 1; }
    .right-col { width: 400px; flex-shrink: 0; }

    /* ===== CARD STYLE ===== */
    .card-style-1 {
      background: #fff; border: 1px solid #efefef; border-radius: 10px;
      padding: 25px 30px; box-shadow: 0px 12px 24px -4px rgba(145,158,171,0.12);
      margin-bottom: 20px;
    }

    /* ===== FORMULÁRIOS & CAMPOS ===== */
    .fields-grid-2cols {
      display: grid; grid-template-columns: repeat(2, 1fr);
      gap: 1rem; margin-bottom: 1rem;
    }
    .fields-grid-3cols {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 1rem; margin-bottom: 1rem;
    }
    .form-field {
      display: flex; flex-direction: column; margin-bottom: 1rem;
    }
    .form-field label {
      font-size: 0.85rem; color: #666; margin-bottom: 0.4rem; font-weight: 500;
    }
    .form-field input, .form-field select {
      font-size: 0.85rem; padding: 0.6rem; border: 1px solid #eee; border-radius: 4px;
    }
    .form-field input:focus, .form-field select:focus {
      border-color: #007aff;
    }
    .form-note {
      font-size: 0.75rem; color: #888; margin-top: 1rem;
    }

    /* ===== BOTÕES GERAIS ===== */
    .btn-save-passenger, .btn-pay-pal {
      background: #007aff; color: #fff; border: none; border-radius: 4px;
      padding: 0.75rem 1.5rem; font-size: 0.9rem; cursor: pointer;
    }
    .btn-save-passenger:hover, .btn-pay-pal:hover {
      background: #005dbf; box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .navigation {
      margin-top: 1rem; text-align: right;
    }

    /* ===== RESERVATION / CART (RIGHT COLUMN) ===== */
    .reservation-gifts-card {
      background: #fff; border: 1px solid #efefef; border-radius: 10px;
      padding: 25px 30px; box-shadow: 0px 12px 24px -4px rgba(145,158,171,0.12);
    }
    .reserva-item {
      display: grid; grid-template-columns: auto 1fr auto; gap: 1rem;
      padding: 0.75rem 0; border-bottom: 1px solid #eee; margin-bottom: 0.75rem;
      align-items: center;
    }
    .reserva-item:last-child {
      border-bottom: none; margin-bottom: 0;
    }
    .reserva-left { display: flex; flex-direction: column; gap: 0.25rem; }
    .reserva-left .categoria {
      font-size: 0.85rem; font-weight: 600; color: #007aff;
    }
    .reserva-left .nome {
      font-size: 0.85rem; color: #333;
    }
    .reserva-left .subinfo {
      font-size: 0.8rem; color: #888;
    }
    .reserva-preco {
      font-size: 1rem; font-weight: 700; color: #00c853; text-align: right;
    }
    .reserva-details p {
      font-size: 0.8rem; margin: 2px 0; color: #555;
    }
    .resumo-compra {
      margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;
    }
    .resumo-compra .resumo-row {
      display: flex; justify-content: space-between; margin-bottom: 10px;
    }
    .resumo-compra .resumo-row label { font-weight: 600; }
    .resumo-compra .resumo-row p { font-weight: 600; margin: 0; }
    .resumo-compra .cupom { margin-top: 15px; }
    .resumo-compra .cupom label { font-weight: 600; }

    /* ===== STEP CONTENTS ===== */
    .step-content { display: none; }
    .step-content.active { display: block; }

    /* ===== STEP 3: PAGAMENTO ===== */
    #card-container {
      margin-top: 1rem; background: #fafafa; border: 1px solid #ddd;
      border-radius: 8px; padding: 1.5rem;
    }
    #card-number, #expiration-date, #cvv {
      display: flex; align-items: center; height: 44px; background: #fff;
      border: 1px solid #ccc; border-radius: 6px; padding: 0 8px; transition: border-color 0.3s;
    }
    #card-number:focus-within, #expiration-date:focus-within, #cvv:focus-within {
      border-color: #007aff;
    }
    #installments {
      width: 100%; border: 1px solid #ccc; border-radius: 6px;
      padding: 0.4rem; margin-top: 0.2rem;
    }
    #checkout-form button.btn-pay-pal {
      margin-top: 1rem; width: 100%; font-weight: 600;
    }
    #paypal-container, #pix-container, #boleto-container {
      margin-top: 1rem; background: #fafafa; border: 1px solid #ddd;
      border-radius: 8px; padding: 1rem; display: none;
    }

    /* ===== BOTÃO "Nomear passageiros (Obrigatório)➕" ===== */
    .btn-add-passenger {
      display: block; width: 100%; background: #fff; border: 1px solid #dcdcdc;
      border-radius: 8px; padding: 1rem 0; color: #1f2b47; text-align: center;
      margin: 1rem auto; font-weight: 600; font-size: 1rem;
    }
    .btn-add-passenger:hover {
      background: #f1f5f9; color: #365cf5;
    }

    /* ===== MODAL (GENÉRICO) ===== */
    .modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
      overflow: auto; background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff; margin: 5% auto; padding: 20px 25px; border-radius: 12px;
      width: 90%; max-width: 700px; box-shadow: 0 8px 30px rgba(0,0,0,0.2); position: relative;
    }
    .close-modal {
      position: absolute; right: 15px; top: 10px; font-size: 24px; font-weight: bold; cursor: pointer;
    }
    .modal-content h3 {
      font-size: 1.2rem; margin-bottom: 0.5rem; color: #333;
    }
    .modal-subtitle {
      font-size: 0.9rem; color: #555; margin-bottom: 1.5rem; line-height: 1.4;
    }
    .passenger-box {
      background: #fff; border: 1px solid #ddd; border-radius: 8px;
      padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .passenger-box h4 { font-size: 1rem; margin-bottom: 0.5rem; color: #333; }
    .fields-grid-2cols-modal {
      display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;
    }
    .copy-for-all-btn { background: #365cf5; color: #fff; margin-right: 1rem; }

    /* ===== STEP 2: TABELA DE COMPARAÇÃO (4 colunas) ===== */
    .plans-comparison {
      width: 100%; overflow-x: auto; background: #f9f9f9; border-radius: 8px;
      padding: 1rem; margin-bottom: 1rem;
    }
    .comparison-table {
      width: 100%; border-collapse: collapse; text-align: center;
    }
    .comparison-table thead tr { background: #fdfdfd; }
    .comparison-table th,
    .comparison-table td {
      padding: 1rem;
      border-bottom: 1px solid #eee;
      font-size: 0.85rem; vertical-align: middle;
    }
    .comparison-table thead th {
      font-weight: 600; font-size: 0.9rem; color: #333; border-bottom: 2px solid #ddd;
    }
    .comparison-table tfoot td {
      border-top: 2px solid #ddd; font-weight: 600; padding: 1rem;
    }
    .comparison-table td:first-child {
      text-align: left;
      font-weight: 500;
    }
    .comparison-table input[type="radio"] {
      transform: scale(1.2); cursor: pointer;
      margin-top: 15px;
    }
    .check { color: #00c853; font-weight: 700; }
    .x { color: #d32f2f; font-weight: 700; }
    .price {
      font-size: 1rem; color: #333; font-weight: 700; margin-bottom: 0.5rem; display: block;
    }
    .recommended {
      background: #e8f1ff; position: relative;
    }
    .recommended::after {
      content: "Recomendado"; position: absolute; top: -10px; right: 50%;
      transform: translateX(50%); background: #007aff; color: #fff;
      font-size: 0.7rem; font-weight: 600; padding: 0.3rem 0.6rem; border-radius: 8px;
    }

    /* ===== BOTÕES DE OPÇÕES DE PAGAMENTO (estilizados) ===== */
    .payment-method-options {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    .payment-method-options input[type="radio"] {
      display: none;
    }
    .payment-method-options label {
      display: inline-block;
      background: #fff;
      border: 2px solid #ccc;
      border-radius: 6px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    .payment-method-options label:hover {
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }
    .payment-method-options input[type="radio"]:checked + label {
      background: #007aff;
      color: #fff;
      border-color: #007aff;
    }
  </style>
</head>
<body>
  <!-- STEPS MENU -->
  <div class="steps-menu" id="stepsMenu">
    <div class="step active" data-step="1">
      <div class="circle">1</div>
      <span>Passageiros</span>
    </div>
    <div class="separator">></div>
    <div class="step" data-step="2">
      <div class="circle">2</div>
      <span>Detalhes</span>
    </div>
    <div class="separator">></div>
    <div class="step" data-step="3">
      <div class="circle">3</div>
      <span>Pagamento</span>
    </div>
    <div class="separator">></div>
    <div class="step" data-step="4">
      <div class="circle">4</div>
      <span>Confirmação</span>
    </div>
  </div>

  <div class="main-container">
    <!-- COLUNA ESQUERDA -->
    <div class="left-col">
      <!-- STEP 1: PASSAGEIRO PRINCIPAL -->
      <div class="step-content active" data-step="1">
        <div class="card-style-1">
          <h2>Passageiro Principal</h2>
          <div style="text-align:right; margin-bottom:1rem;">
            <a href="#" id="toggleLogin">Economize tempo fazendo Login</a>
          </div>
          <!-- LOGIN FIELDS -->
          <div id="loginFields" style="display:none;">
            <div class="fields-grid-2cols">
              <div class="form-field">
                <label>E-mail *</label>
                <input type="email" id="loginEmail" placeholder="seuemail@exemplo.com">
              </div>
              <div class="form-field">
                <label>Senha *</label>
                <input type="password" id="loginPassword" placeholder="********">
              </div>
            </div>
            <div style="text-align:right; margin-top:10px;">
              <button class="btn-save-passenger" id="loginValidateBtn">Entrar</button>
            </div>
          </div>

          <!-- REGISTRATION FIELDS -->
          <div id="registrationFieldsGeneral">
            <div class="fields-grid-2cols">
              <div class="form-field">
                <label>Nome *</label>
                <input type="text" id="firstName" placeholder="Nome">
              </div>
              <div class="form-field">
                <label>Sobrenome *</label>
                <input type="text" id="lastName" placeholder="Sobrenome">
              </div>
            </div>
            <div class="fields-grid-2cols">
              <div class="form-field">
                <label>Celular *</label>
                <input type="text" id="celular" placeholder="(XX) 99999-9999">
              </div>
              <div class="form-field">
                <label>E-mail *</label>
                <input type="email" id="email" placeholder="seuemail@exemplo.com">
              </div>
            </div>
            <div class="fields-grid-2cols">
              <div class="form-field">
                <label>Senha *</label>
                <input type="password" id="password" placeholder="********">
              </div>
              <div class="form-field">
                <label>Repetir Senha *</label>
                <input type="password" id="confirmPassword" placeholder="********">
              </div>
            </div>
          </div>
          <!-- CAMPOS DE DOCUMENTOS/ENDEREÇO -->
          <div id="documentFields">
            <div class="fields-grid-3cols">
              <div class="form-field">
                <label>CPF *</label>
                <input type="text" id="cpf" placeholder="123.456.789-00">
              </div>
              <div class="form-field">
                <label>RG *</label>
                <input type="text" id="rg" placeholder="12.345.678-9">
              </div>
              <div class="form-field">
                <label>Data de Nascimento *</label>
                <input type="date" id="birthdate" placeholder="dd/mm/aaaa">
              </div>
            </div>
            <div class="fields-grid-3cols">
              <div class="form-field">
                <label>CEP *</label>
                <input type="text" id="cep" placeholder="12345-678">
              </div>
              <div class="form-field">
                <label>Estado *</label>
                <input type="text" id="state" placeholder="Ex: SP">
              </div>
              <div class="form-field">
                <label>Cidade *</label>
                <input type="text" id="city" placeholder="São Paulo">
              </div>
            </div>
            <div class="fields-grid-2cols">
              <div class="form-field">
                <label>Endereço *</label>
                <input type="text" id="address" placeholder="Rua, Avenida...">
              </div>
              <div class="form-field">
                <label>Número *</label>
                <input type="text" id="number" placeholder="123">
              </div>
            </div>
          </div>

          <button class="btn-add-passenger" id="openPassengerModal">Nomear passageiros (Obrigatório)➕</button>
          <p class="form-note">* Insira o nome exatamente como aparece em seus documentos.</p>
          <div class="navigation">
            <button class="btn-save-passenger" id="toStep2">Próximo</button>
          </div>
        </div>

        <!-- MODAL PASSAGEIROS EXTRAS -->
        <div id="passengerModal" class="modal">
          <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h3>Passageiros Extras – Nomeação Obrigatória</h3>
            <p class="modal-subtitle">
              Nomear todos os passageiros é essencial para garantir acesso sem imprevistos aos serviços adquiridos.
            </p>
            <div id="modalPassengerContainer"></div>
            <div style="text-align:right; margin-top:1rem;">
              <button class="btn-save-passenger copy-for-all-btn" id="copyForAllBtn" style="display:none;">Copiar para todos</button>
              <button class="btn-save-passenger" id="savePassengersBtn">Salvar Passageiros</button>
            </div>
          </div>
        </div>
      </div>

      <!-- STEP 2: Tabela Comparativa (4 colunas) -->
      <div class="step-content" data-step="2">
        <div class="card-style-1">
          <h2>Voo atrasado? Receba sua indenização com AirHelp Plus</h2>
          <p style="margin-bottom:1rem; font-size:0.9rem; color:#555;">
            Se seu voo atrasar ou for cancelado, você pode ter direito a uma compensação. Compare seu plano atual com o Essencial e o Completo.
          </p>
          <div class="plans-comparison">
            <table class="comparison-table">
              <thead>
                <tr>
                  <th style="text-align:left;">Itens</th>
                  <th>Seu Plano</th>
                  <th class="recommended">Plano Essencial</th>
                  <th>Plano Completo</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="text-align:left; font-weight:600;">Cobertura</td>
                  <td>Indefinida</td>
                  <td>U$30.000</td>
                  <td>U$80.000</td>
                </tr>
                <tr>
                  <td style="text-align:left;">Pagamento é feito pelo seguro direto ao local sem burocracia</td>
                  <td><span class="x">✖</span></td>
                  <td><span class="check">✅</span></td>
                  <td><span class="check">✅</span></td>
                </tr>
                <tr>
                  <td style="text-align:left;">Você paga e tenta ser reembolsado</td>
                  <td><span class="check">✅</span></td>
                  <td><span class="x">✖</span></td>
                  <td><span class="x">✖</span></td>
                </tr>
                <tr>
                  <td style="text-align:left;">Atendimento em português</td>
                  <td><span class="x">✖</span></td>
                  <td><span class="check">✅</span></td>
                  <td><span class="check">✅</span></td>
                </tr>
                <tr>
                  <td style="text-align:left;">Cobertura farmacêutica</td>
                  <td><span class="x">✖</span></td>
                  <td><span class="check">✅</span></td>
                  <td><span class="check">✅</span></td>
                </tr>
                <tr>
                  <td style="text-align:left;">Você ganha brinde por comprar</td>
                  <td><span class="x">✖</span></td>
                  <td><span class="check">✅</span></td>
                  <td><span class="check">✅</span></td>
                </tr>
              </tbody>
              <tfoot>
                <tr>
                  <td></td>
                  <td>
                    <span class="price">R$ 0,00</span>
                    <input type="radio" name="insuranceOption" value="none" />
                  </td>
                  <td>
                    <span class="price">R$ 60,65</span>
                    <a href="#" class="openEssencialModal" style="font-size:0.8rem; color:#007aff; margin-right:8px;">Ver Detalhes</a>
                    <input type="radio" name="insuranceOption" value="essencial" />
                  </td>
                  <td>
                    <span class="price">R$ 101,09</span>
                    <a href="#" class="openCompletoModal" style="font-size:0.8rem; color:#007aff; margin-right:8px;">Ver Detalhes</a>
                    <input type="radio" name="insuranceOption" value="completo" />
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
          <div class="navigation">
            <button class="btn-save-passenger" id="backToStep1">Voltar</button>
            <button class="btn-save-passenger" id="toStep3">Próximo</button>
          </div>
        </div>
      </div>

      <!-- STEP 3: Pagamento -->
      <div class="step-content" data-step="3">
        <div class="card-style-1">
          <h2>Pagamento</h2>
          <p style="margin-bottom:1rem;">Escolha o método de pagamento abaixo.</p>
          <div class="form-field">
            <label>Método de Pagamento</label>
            <div class="payment-method-options">
              <input type="radio" id="methodCard" name="paymentMethod" value="card" checked />
              <label for="methodCard">Cartão de Crédito</label>

              <input type="radio" id="methodPayPal" name="paymentMethod" value="paypal" />
              <label for="methodPayPal">PayPal</label>

              <input type="radio" id="methodPix" name="paymentMethod" value="pix" />
              <label for="methodPix">Pix</label>

              <input type="radio" id="methodBoleto" name="paymentMethod" value="boleto" />
              <label for="methodBoleto">Boleto</label>
            </div>
          </div>

          <!-- Container Cartão -->
          <div id="card-container">
            <div class="form-field">
              <label>Parcelas</label>
              <select id="installments">
                <option value="1">1x</option>
                <option value="2">2x</option>
                <option value="3">3x</option>
                <option value="4">4x</option>
                <option value="5">5x</option>
                <option value="6">6x</option>
                <option value="7">7x</option>
                <option value="8">8x</option>
                <option value="9">9x</option>
                <option value="10">10x</option>
              </select>
            </div>
            <form id="checkout-form">
              <div class="form-field">
                <label>Número do Cartão</label>
                <div id="card-number" style="border:1px solid #ccc; padding:10px;"></div>
              </div>
              <div class="fields-grid-2cols">
                <div class="form-field">
                  <label>Data de Expiração (MM/AA)</label>
                  <div id="expiration-date" style="border:1px solid #ccc; padding:10px;"></div>
                </div>
                <div class="form-field">
                  <label>CVV</label>
                  <div id="cvv" style="border:1px solid #ccc; padding:10px;"></div>
                </div>
              </div>
              <button type="submit" class="btn-pay-pal">Pagar</button>
            </form>
          </div>

          <!-- Container PayPal -->
          <div id="paypal-container">
            <div id="paypal-button-container"></div>
          </div>

          <!-- Container Pix -->
          <div id="pix-container">
            <p>Após finalizar, será gerado um QR Code para pagamento via Pix.</p>
            <button class="btn-pay-pal" id="pixPaymentBtn">Gerar Pix</button>
          </div>

          <!-- Container Boleto -->
          <div id="boleto-container">
            <p>Após finalizar, será gerado um boleto bancário.</p>
            <button class="btn-pay-pal" id="boletoPaymentBtn">Gerar Boleto</button>
          </div>

          <div class="navigation">
            <button class="btn-save-passenger" id="backToStep2">Voltar</button>
          </div>
        </div>
      </div>

      <!-- STEP 4: Confirmação -->
      <div class="step-content" data-step="4">
        <div class="card-style-1">
          <h2>Pagamento Concluído</h2>
          <p>Seu pagamento foi efetuado com sucesso!</p>
          <p>Obrigado por sua compra.</p>
        </div>
      </div>
    </div>

    <!-- COLUNA DIREITA: Resumo do Carrinho -->
    <div class="right-col">
      <div class="card-style-1 reservation-gifts-card">
        <h2>Informações da Reserva</h2>
        <div id="cartItemsList"></div>
        <div class="resumo-compra">
          <div class="form-field cupom">
            <label>Cupom de Desconto</label>
            <input type="text" id="couponInput" placeholder="Insira seu cupom">
          </div>
          <div class="resumo-row">
            <label>Subtotal</label>
            <p id="subtotalValue">R$ 0,00</p>
          </div>
          <div class="resumo-row">
            <label>Desconto</label>
            <p id="discountValue">- R$ 0,00</p>
          </div>
          <div class="resumo-row total-line">
            <label>Total do Pedido</label>
            <p id="totalValue">R$ 0,00</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    © 2025 - Airland
  </footer>

  <!-- (Opcional) Shopping Cart oculto -->
  <shopping-cart id="shoppingCart" style="display:none;"></shopping-cart>

  <!-- MODAL: Detalhes do Plano Essencial -->
  <div class="modal" id="modalIntermac30K" style="display:none;">
    <div class="modal-content">
      <span class="close-modal" data-close-modal="modalIntermac30K">&times;</span>
      <h3 style="margin-bottom: 1rem;">Plano Essencial – Detalhes</h3>
      <p style="font-size:0.9rem; color:#555; margin-bottom:1rem;">
        Confira abaixo a cobertura completa do Plano Essencial.
      </p>
      <table class="coverage-table">
        <thead>
          <tr>
            <th>Coberturas</th>
            <th>Valores</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Despesas Emergenciais Médicas e Hospitalares em Viagem Internacional</td><td>$30,000.00</td></tr>
          <tr><td>Despesas Emergenciais Odontológicas em Caso de Acidente ou Doença Súbita</td><td>$200.00</td></tr>
          <tr><td>Proteção COVID-19 Integral em todas as Coberturas</td><td>INCLUSO NO DMH</td></tr>
          <tr><td>Despesas Farmacêuticas em Caso de Acidente ou Doença Súbita</td><td>$150.00</td></tr>
          <tr><td>Remoção Médica</td><td>$20,000.00</td></tr>
          <tr><td>Repatriação Médica</td><td>$20,000.00</td></tr>
          <tr><td>Repatriação Funerária</td><td>$20,000.00</td></tr>
          <tr><td>Prorrogação de Estadia</td><td>$375.00</td></tr>
          <tr><td>Retorno de Menores (Passagem Ida e Volta)</td><td>$1,500.00</td></tr>
          <tr><td>Retorno do Segurado</td><td>$1,500.00</td></tr>
          <tr><td>Hospedagem de Acompanhante</td><td>$375.00</td></tr>
          <tr><td>Acompanhante em Caso de Hospitalização Prolongada</td><td>$1,500.00</td></tr>
          <tr><td>Despesas Jurídicas</td><td>$1,000.00</td></tr>
          <tr><td>Fiança e Despesas Legais</td><td>$1,500.00</td></tr>
          <tr><td>Cancelamento de Viagem</td><td>$500.00</td></tr>
          <tr><td>Perda ou Roubo de Bagagem</td><td>$350.00</td></tr>
          <tr><td>Invalidez Permanente Total ou Parcial por Acidente</td><td>$7,500.00</td></tr>
          <tr><td>Morte Acidental</td><td>$7,500.00</td></tr>
          <tr><td>Interrupção de Viagem</td><td>N/A</td></tr>
          <tr><td>Atraso de Bagagem (depois de 12h)</td><td>$100.00</td></tr>
          <tr><td>Atraso de Vôo</td><td>$100.00</td></tr>
          <tr><td>Gravidez até 28 semanas</td><td>INCLUSO NO DMH</td></tr>
          <tr><td>Esporte a Lazer e Amador</td><td>INCLUSO NO DMH</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- MODAL: Detalhes do Plano Completo -->
  <div class="modal" id="modalIntermac80K" style="display:none;">
    <div class="modal-content">
      <span class="close-modal" data-close-modal="modalIntermac80K">&times;</span>
      <h3 style="margin-bottom: 1rem;">Plano Completo – Detalhes</h3>
      <p style="font-size:0.9rem; color:#555; margin-bottom:1rem;">
        Confira abaixo a cobertura completa do Plano Completo.
      </p>
      <table class="coverage-table">
        <thead>
          <tr>
            <th>Coberturas</th>
            <th>Valores</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Despesas Emergenciais Médicas e Hospitalares em Viagem Internacional</td><td>$80,000.00</td></tr>
          <tr><td>Despesas Emergenciais Odontológicas em Caso de Acidente ou Doença Súbita</td><td>$800.00</td></tr>
          <tr><td>Proteção COVID-19 Integral em todas as Coberturas</td><td>INCLUSO NO DMH</td></tr>
          <tr><td>Despesas Farmacêuticas em Caso de Acidente ou Doença Súbita</td><td>$800.00</td></tr>
          <tr><td>Remoção Médica</td><td>$50,000.00</td></tr>
          <tr><td>Repatriação Médica</td><td>$50,000.00</td></tr>
          <tr><td>Repatriação Funerária</td><td>$50,000.00</td></tr>
          <tr><td>Prorrogação de Estadia</td><td>$5,000.00</td></tr>
          <tr><td>Retorno de Menores (Passagem Ida e Volta)</td><td>$1,500.00</td></tr>
          <tr><td>Retorno do Segurado</td><td>$1,500.00</td></tr>
          <tr><td>Hospedagem de Acompanhante</td><td>$500.00</td></tr>
          <tr><td>Acompanhante em Caso de Hospitalização Prolongada</td><td>$1,500.00</td></tr>
          <tr><td>Despesas Jurídicas</td><td>$1,600.00</td></tr>
          <tr><td>Fiança e Despesas Legais</td><td>$5,000.00</td></tr>
          <tr><td>Cancelamento de Viagem</td><td>$1,250.00</td></tr>
          <tr><td>Perda ou Roubo de Bagagem</td><td>$750.00</td></tr>
          <tr><td>Invalidez Permanente Total ou Parcial por Acidente</td><td>$17,500.00</td></tr>
          <tr><td>Morte Acidental</td><td>$17,500.00</td></tr>
          <tr><td>Interrupção de Viagem</td><td>$750.00</td></tr>
          <tr><td>Atraso de Bagagem (depois de 12h)</td><td>$250.00</td></tr>
          <tr><td>Atraso de Vôo</td><td>$250.00</td></tr>
          <tr><td>Gravidez até 28 semanas</td><td>INCLUSO NO DMH</td></tr>
          <tr><td>Esporte a Lazer e Amador</td><td>INCLUSO NO DMH</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    /* =============================================
       LÓGICA DE MULTI-STEP, PASSAGEIROS EXTRAS (MODAL),
       LOGIN/REGISTRO, CEP, MÁSCARAS, E BRAINTREE
       ============================================= */

    // Controle de login/registro
    let isLoginMode = false;
    let isRegistrationMode = true;
    const isLoggedIn = !!localStorage.getItem("agentId");

    const toggleLoginLink = document.getElementById("toggleLogin");
    const registrationFieldsGeneral = document.getElementById("registrationFieldsGeneral");
    const loginFields = document.getElementById("loginFields");

    toggleLoginLink.addEventListener("click", e => {
      e.preventDefault();
      if (isRegistrationMode) {
        isLoginMode = true;
        isRegistrationMode = false;
        registrationFieldsGeneral.style.display = "none";
        loginFields.style.display = "block";
        toggleLoginLink.textContent = "Não tenho Login";
      } else {
        isLoginMode = false;
        isRegistrationMode = true;
        registrationFieldsGeneral.style.display = "block";
        loginFields.style.display = "none";
        toggleLoginLink.textContent = "Economize tempo fazendo Login";
      }
    });

    function isRegistrationComplete() {
      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      const celular = document.getElementById("celular").value.trim();
      const email = document.getElementById("email").value.trim();
      const pass = document.getElementById("password").value.trim();
      const confirmPass = document.getElementById("confirmPassword").value.trim();

      const cpf = document.getElementById("cpf").value.trim();
      const rg = document.getElementById("rg").value.trim();
      const birthdate = document.getElementById("birthdate").value.trim();
      const cep = document.getElementById("cep").value.trim();
      const state = document.getElementById("state").value.trim();
      const city = document.getElementById("city").value.trim();
      const address = document.getElementById("address").value.trim();
      const number = document.getElementById("number").value.trim();

      if (!firstName || !lastName || !celular || !email ||
          !pass || !confirmPass || !cpf || !rg || !birthdate ||
          !cep || !state || !city || !address || !number) {
        return false;
      }
      if (pass !== confirmPass) {
        alert("As senhas não coincidem!");
        return false;
      }
      return true;
    }

    function isLoginComplete() {
      const loginEmail = document.getElementById("loginEmail").value.trim();
      const loginPassword = document.getElementById("loginPassword").value.trim();
      if (!loginEmail || !loginPassword) {
        return false;
      }
      return true;
    }

    const loginValidateBtn = document.getElementById("loginValidateBtn");
    loginValidateBtn.addEventListener("click", () => {
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value.trim();
      fetch("/api/users/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      })
      .then(res => res.json())
      .then(data => {
        if(data.success) {
          localStorage.setItem("agentId", data.user.id);
          alert("Login efetuado com sucesso!");
        } else {
          alert("Erro no login: " + (data.error || "Dados inválidos."));
        }
      })
      .catch(err => {
        console.error(err);
        alert("Erro ao realizar o login. Tente novamente.");
      });
    });

    const toStep2Btn = document.getElementById("toStep2");
    toStep2Btn.addEventListener("click", () => {
      if (!isLoggedIn) {
        if (isLoginMode) {
          if (!isLoginComplete()) {
            alert("Por favor, preencha E-mail e Senha de Login.");
            return;
          }
        } else {
          if (!isRegistrationComplete()) {
            alert("Por favor, preencha todos os campos obrigatórios do passageiro principal.");
            return;
          }
        }
      }
      if (!areAllExtraPassengersFilled()) {
        alert("Por favor, preencha todos os campos dos passageiros extras.");
        return;
      }
      showStep(2);
    });

    // Define a estrutura principal de dados
    let checkoutData = {
      mainPassenger: {
        firstName: "",
        lastName: "",
        cpf: "",
        rg: "",
        birthdate: "",
        celular: "",
        email: "",
        address: "",
        number: "",
        city: "",
        state: "",
        cep: ""
      },
      extraPassengers: [],
      insuranceSelected: "none",
      insuranceCost: 0
    };

    const stepContents = document.querySelectorAll(".step-content");
    const stepButtons = document.querySelectorAll(".steps-menu .step");

    function showStep(stepNumber) {
      stepContents.forEach(content => {
        content.classList.toggle("active", content.dataset.step === String(stepNumber));
      });
      stepButtons.forEach(button => {
        const btnStep = parseInt(button.dataset.step, 10);
        button.classList.toggle("active", btnStep === stepNumber);
        if (btnStep > stepNumber) {
          button.classList.add("disabled");
        } else {
          button.classList.remove("disabled");
        }
      });
    }

    const backToStep1Btn = document.getElementById("backToStep1");
    const toStep3Btn = document.getElementById("toStep3");
    const backToStep2Btn = document.getElementById("backToStep2");

    backToStep1Btn?.addEventListener("click", () => showStep(1));

    toStep3Btn.addEventListener("click", () => {
      const selectedInsurance = document.querySelector('input[name="insuranceOption"]:checked');
      checkoutData.insuranceSelected = selectedInsurance ? selectedInsurance.value : "none";

      if (checkoutData.insuranceSelected === "30k") {
        checkoutData.insuranceCost = 112.81;
      } else if (checkoutData.insuranceSelected === "80k") {
        checkoutData.insuranceCost = 212.02;
      } else {
        checkoutData.insuranceCost = 0;
      }
      updateCheckoutCart(cartItems);
      showStep(3);
      initializePaymentMethod();
    });

    backToStep2Btn?.addEventListener("click", () => showStep(2));

    let cartItems = [];
    const cartElement = document.getElementById("shoppingCart");
    if (cartElement && cartElement.items && cartElement.items.length > 0) {
      cartItems = cartElement.items;
    } else {
      const savedCart = localStorage.getItem("cartItems");
      if (savedCart) {
        cartItems = JSON.parse(savedCart);
      } else {
        // Exemplo de itens de carrinho (mock)
        cartItems = [
          {
            hotelName: "Courtyard By Marriott Miami Downtown",
            adults: 2,
            children: 1,
            basePriceAdult: 100,
            checkIn: "2025-04-16",
            checkOut: "2025-04-18"
          },
          {
            hotelName: "Courtyard By Marriott Miami Downtown",
            adults: 2,
            children: 0,
            basePriceAdult: 150,
            checkIn: "2025-04-10",
            checkOut: "2025-04-12"
          }
        ];
      }
    }

    function updateCheckoutCart(items) {
      const container = document.getElementById("cartItemsList");
      let subtotal = 0;
      let html = "";
      items.forEach(item => {
        let price = item.basePriceAdult || 80;
        subtotal += price;
        html += `
          <div class="reserva-item">
            <div class="reserva-left">
              <span class="categoria">${item.type || "Hospedagem"}</span>
              <span class="nome">${item.hotelName || "Hotel Desconhecido"} - ${item.roomName || "Quarto"}</span>
              <div class="reserva-details">
                <p>Check-in: ${item.checkIn || "--/--/----"}</p>
                <p>Check-out: ${item.checkOut || "--/--/----"}</p>
                <p>Quartos: ${item.rooms || 1}</p>
                <p>Adultos: ${item.adults || 1} | Crianças: ${item.children || 0}</p>
              </div>
            </div>
            <div class="reserva-preco">
              R$ ${price.toLocaleString("pt-BR", { minimumFractionDigits: 2 })}
            </div>
          </div>
        `;
      });
      subtotal += checkoutData.insuranceCost;
      container.innerHTML = html;
      document.getElementById("subtotalValue").textContent =
        "R$ " + subtotal.toLocaleString("pt-BR", { minimumFractionDigits: 2 });
      document.getElementById("discountValue").textContent = "- R$ 0,00";
      document.getElementById("totalValue").textContent =
        "R$ " + subtotal.toLocaleString("pt-BR", { minimumFractionDigits: 2 });
    }

    function areAllExtraPassengersFilled() {
      for (let i = 0; i < checkoutData.extraPassengers.length; i++) {
        const item = checkoutData.extraPassengers[i];
        if (!item) continue;
        for (let p = 0; p < item.length; p++) {
          const pass = item[p];
          if (!pass.name || !pass.birthdate) {
            return false;
          }
        }
      }
      return true;
    }

    const passengerModal = document.getElementById("passengerModal");
    const openPassengerModalBtn = document.getElementById("openPassengerModal");
    const closeModalBtn = document.getElementById("closeModal");
    const savePassengersBtn = document.getElementById("savePassengersBtn");
    const modalPassengerContainer = document.getElementById("modalPassengerContainer");
    const copyForAllBtn = document.getElementById("copyForAllBtn");

    function createModalPassengerForms(items) {
      modalPassengerContainer.innerHTML = "";
      let itemsWithExtras = 0;
      items.forEach((item, itemIndex) => {
        const extraCount = (item.adults || 1) - 1;
        if (extraCount > 0) {
          itemsWithExtras++;
          if (!checkoutData.extraPassengers[itemIndex]) {
            checkoutData.extraPassengers[itemIndex] = [];
          }
          const itemDiv = document.createElement("div");
          itemDiv.classList.add("passenger-box");
          itemDiv.innerHTML = `<h4>${item.hotelName || "Item"}</h4>`;
          for (let i = 0; i < extraCount; i++) {
            if (!checkoutData.extraPassengers[itemIndex][i]) {
              checkoutData.extraPassengers[itemIndex][i] = {
                name: "",
                birthdate: ""
              };
            }
            const passName = checkoutData.extraPassengers[itemIndex][i].name || "";
            const passBirth = checkoutData.extraPassengers[itemIndex][i].birthdate || "";
            const fieldsWrapper = document.createElement("div");
            fieldsWrapper.classList.add("fields-grid-2cols-modal");
            fieldsWrapper.innerHTML = `
              <div class="form-field">
                <label>Nome do Passageiro #${i+1}</label>
                <input type="text" placeholder="Nome completo" data-item-index="${itemIndex}" data-passenger-index="${i}" class="modalExtraNameInput" value="${passName}" />
              </div>
              <div class="form-field">
                <label>Data de Nascimento</label>
                <input type="date" data-item-index="${itemIndex}" data-passenger-index="${i}" class="modalExtraBirthdateInput" value="${passBirth}" />
              </div>
            `;
            itemDiv.appendChild(fieldsWrapper);
          }
          modalPassengerContainer.appendChild(itemDiv);
        }
      });
      copyForAllBtn.style.display = (itemsWithExtras > 1) ? "inline-block" : "none";
    }

    openPassengerModalBtn.addEventListener("click", e => {
      e.preventDefault();
      createModalPassengerForms(cartItems);
      passengerModal.style.display = "block";
    });

    closeModalBtn.addEventListener("click", () => {
      passengerModal.style.display = "none";
    });

    savePassengersBtn.addEventListener("click", () => {
      if (!areAllExtraPassengersFilled()) {
        alert("Preencha todos os campos de passageiros extras.");
        return;
      }
      passengerModal.style.display = "none";
      alert("Passageiros extras salvos!");
    });

    copyForAllBtn.addEventListener("click", () => {
      let sourceIndex = null;
      let sourceExtraCount = 0;
      for (let i = 0; i < cartItems.length; i++) {
        let extraCount = (cartItems[i].adults || 1) - 1;
        if (extraCount > 0) {
          sourceIndex = i;
          sourceExtraCount = extraCount;
          break;
        }
      }
      if (sourceIndex === null) return;
      const sourceData = checkoutData.extraPassengers[sourceIndex] || [];
      for (let i = 0; i < cartItems.length; i++) {
        if (i !== sourceIndex) {
          let extraCount = (cartItems[i].adults || 1) - 1;
          if (extraCount === sourceExtraCount && extraCount > 0) {
            checkoutData.extraPassengers[i] = JSON.parse(JSON.stringify(sourceData));
            for (let passIndex = 0; passIndex < extraCount; passIndex++) {
              const nameSelector = `.modalExtraNameInput[data-item-index="${i}"][data-passenger-index="${passIndex}"]`;
              const birthSelector = `.modalExtraBirthdateInput[data-item-index="${i}"][data-passenger-index="${passIndex}"]`;
              const nameInput = document.querySelector(nameSelector);
              const birthInput = document.querySelector(birthSelector);
              if (nameInput && birthInput && checkoutData.extraPassengers[i][passIndex]) {
                nameInput.value = checkoutData.extraPassengers[i][passIndex].name || "";
                birthInput.value = checkoutData.extraPassengers[i][passIndex].birthdate || "";
              }
            }
          }
        }
      }
      alert("Dados copiados para todos os itens compatíveis!");
    });

    modalPassengerContainer.addEventListener("input", e => {
      const target = e.target;
      if (target.classList.contains("modalExtraNameInput") || target.classList.contains("modalExtraBirthdateInput")) {
        const itemIndex = parseInt(target.getAttribute("data-item-index"), 10);
        const passIndex = parseInt(target.getAttribute("data-passenger-index"), 10);
        if (!checkoutData.extraPassengers[itemIndex]) {
          checkoutData.extraPassengers[itemIndex] = [];
        }
        if (!checkoutData.extraPassengers[itemIndex][passIndex]) {
          checkoutData.extraPassengers[itemIndex][passIndex] = {};
        }
        if (target.classList.contains("modalExtraNameInput")) {
          checkoutData.extraPassengers[itemIndex][passIndex].name = target.value.trim();
        } else {
          checkoutData.extraPassengers[itemIndex][passIndex].birthdate = target.value.trim();
        }
      }
    });

    // Inicialização do método de pagamento
    function initializePaymentMethod() {
      const method = document.querySelector('input[name="paymentMethod"]:checked').value;

      // Esconde todos os containers
      document.getElementById("card-container").style.display = "none";
      document.getElementById("paypal-container").style.display = "none";
      document.getElementById("pix-container").style.display = "none";
      document.getElementById("boleto-container").style.display = "none";

      // Mostra apenas o container do método selecionado
      if (method === "card") {
        document.getElementById("card-container").style.display = "block";
        initializeBraintree();
      } else if (method === "paypal") {
        document.getElementById("paypal-container").style.display = "block";
        initializePayPal();
      } else if (method === "pix") {
        document.getElementById("pix-container").style.display = "block";
      } else if (method === "boleto") {
        document.getElementById("boleto-container").style.display = "block";
      }
    }

    // Simulação de clique em Pix ou Boleto
    document.getElementById("pixPaymentBtn").addEventListener("click", () => {
      alert("Pagamento via Pix (simulado). Obrigado pela compra!");
      showStep(4);
    });
    document.getElementById("boletoPaymentBtn").addEventListener("click", () => {
      alert("Boleto gerado (simulado). Obrigado pela compra!");
      showStep(4);
    });

    async function initializeBraintree() {
      const res = await fetch("/api/braintree/get-client-token");
      const data = await res.json();
      const clientToken = data.clientToken;

      braintree.client.create({ authorization: clientToken }, (clientErr, clientInstance) => {
        if (clientErr) {
          console.error("Erro ao criar o client Braintree:", clientErr);
          alert("Erro na inicialização do pagamento.");
          return;
        }
        braintree.threeDSecure.create(
          { version: 2, client: clientInstance },
          (threeDSErr, threeDSecureInstance) => {
            if (threeDSErr) {
              console.error("Erro ao criar 3D Secure:", threeDSErr);
              alert("Erro na inicialização do 3D Secure.");
              return;
            }
            braintree.hostedFields.create(
              {
                client: clientInstance,
                styles: {
                  input: { "font-size": "16px", color: "#333" },
                  "input.invalid": { color: "red" },
                  "input.valid": { color: "green" }
                },
                fields: {
                  number: { selector: "#card-number", placeholder: "Número do Cartão" },
                  cvv: { selector: "#cvv", placeholder: "CVV" },
                  expirationDate: { selector: "#expiration-date", placeholder: "MM/AA" }
                }
              },
              (hostedFieldsErr, hostedFieldsInstance) => {
                if (hostedFieldsErr) {
                  console.error("Erro ao criar Hosted Fields:", hostedFieldsErr);
                  alert("Erro ao configurar os campos de pagamento.");
                  return;
                }
                const form = document.getElementById("checkout-form");
                form.addEventListener("submit", (evt) => {
                  evt.preventDefault();
                  hostedFieldsInstance.tokenize((tokenizeErr, payload) => {
                    if (tokenizeErr) {
                      console.error("Erro ao tokenizar:", tokenizeErr);
                      alert("Erro ao processar dados do cartão.");
                      return;
                    }
                    const amount = getOrderAmount();
                    if (!payload.details || !payload.details.bin) {
                      alert("Erro: BIN do cartão não disponível. Digite novamente.");
                      return;
                    }
                    threeDSecureInstance.verifyCard(
                      {
                        nonce: payload.nonce,
                        amount: amount,
                        bin: payload.details.bin,
                        onLookupComplete: (data, next) => {
                          next();
                        }
                      },
                      (verifyErr, threeDSecurePayload) => {
                        if (verifyErr) {
                          console.error("Erro na verificação 3D Secure:", verifyErr);
                          alert("Erro na verificação 3D Secure.");
                          return;
                        }
                        processPayment(threeDSecurePayload.nonce, "card");
                      }
                    );
                  });
                });
              }
            );
          }
        );
      });
    }

    function initializePayPal() {
      fetch("/api/braintree/get-client-token")
        .then(res => res.json())
        .then(data => {
          const clientToken = data.clientToken;
          braintree.client.create({ authorization: clientToken }, (clientErr, clientInstance) => {
            if (clientErr) {
              console.error("Erro ao criar client PayPal:", clientErr);
              alert("Erro na inicialização do PayPal.");
              return;
            }
            braintree.paypalCheckout.create({ client: clientInstance }, (err, paypalCheckoutInstance) => {
              if (err) {
                console.error("Erro ao criar PayPal Checkout:", err);
                alert("Erro na inicialização do PayPal.");
                return;
              }
              paypal.Button.render(
                {
                  env: "sandbox",
                  payment: () => {
                    const total = getOrderAmount();
                    return paypalCheckoutInstance.createPayment({
                      flow: "checkout",
                      amount: total,
                      currency: "BRL"
                    });
                  },
                  onAuthorize: (data, actions) => {
                    return paypalCheckoutInstance.tokenizePayment(data).then((payload) => {
                      processPayment(payload.nonce, "paypal");
                    });
                  },
                  onError: (err) => {
                    console.error("Erro no PayPal:", err);
                    alert("Erro no pagamento com PayPal.");
                  }
                },
                "#paypal-button-container"
              );
            });
          });
        })
        .catch(err => {
          console.error("Erro ao obter client token para PayPal:", err);
        });
    }

    async function processPayment(nonce, method = "card") {
      let totalText = document.getElementById("totalValue").textContent;
      let amount = totalText.replace("R$", "").trim().replace(/\./g, "").replace(",", ".");
      amount = parseFloat(amount).toFixed(2);

      let installments = "1";
      if (method === "card") {
        const installmentsSelect = document.getElementById("installments");
        if (installmentsSelect) {
          installments = installmentsSelect.value;
        }
      }

      const body = {
        paymentMethodNonce: nonce,
        amount: amount,
        installments: installments,
        customer: {
          firstName: checkoutData.mainPassenger.firstName,
          lastName: checkoutData.mainPassenger.lastName,
          email: checkoutData.mainPassenger.email,
          phone: checkoutData.mainPassenger.celular
        },
        billing: {
          streetAddress: checkoutData.mainPassenger.address,
          extendedAddress: checkoutData.mainPassenger.number,
          locality: checkoutData.mainPassenger.city,
          region: checkoutData.mainPassenger.state,
          postalCode: checkoutData.mainPassenger.cep,
          countryCodeAlpha2: "BR"
        },
        mainPassenger: checkoutData.mainPassenger,
        extraPassengers: checkoutData.extraPassengers,
        insuranceSelected: checkoutData.insuranceSelected
      };

      try {
        const res = await fetch("/api/braintree/create-transaction", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        const result = await res.json();
        if (result.success) {
          alert("Pagamento aprovado! Transaction ID: " + result.transactionId);
          showStep(4);
        } else {
          alert("Falha no pagamento: " + result.message);
        }
      } catch (error) {
        console.error("Erro ao processar o pagamento:", error);
        alert("Erro ao processar o pagamento. Tente novamente.");
      }
    }

    function getOrderAmount() {
      let totalText = document.getElementById("totalValue").textContent;
      let amount = totalText.replace("R$", "").trim().replace(/\./g, "").replace(",", ".");
      return parseFloat(amount).toFixed(2);
    }

    window.addEventListener("load", () => {
      updateCheckoutCart(cartItems);
      if (isLoggedIn) {
        toggleLoginLink.style.display = "none";
        registrationFieldsGeneral.style.display = "none";
        loginFields.style.display = "none";
      }
    });

    document.getElementById("cep").addEventListener("blur", function() {
      buscarCEP(this.value);
    });
    function buscarCEP(cep) {
      cep = cep.replace(/\D/g, '');
      if (cep.length === 8) {
        const url = `https://viacep.com.br/ws/${cep}/json/`;
        fetch(url)
          .then(response => response.json())
          .then(data => {
            if (data.erro) {
              alert("CEP não encontrado!");
              return;
            }
            document.getElementById("address").value = data.logradouro || "";
            document.getElementById("city").value = data.localidade || "";
            document.getElementById("state").value = data.uf || "";
          })
          .catch(error => {
            console.error("Erro ao buscar CEP:", error);
            alert("Não foi possível consultar o CEP.");
          });
      }
    }

    document.getElementById("cpf").addEventListener("input", function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if(value.length > 3) {
        value = value.replace(/^(\d{3})(\d)/, '$1.$2');
      }
      if(value.length > 6) {
        value = value.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
      }
      if(value.length > 9) {
        value = value.replace(/(\d{3})\.(\d{3})\.(\d{3})(\d{1,2}).*/, '$1.$2.$3-$4');
      }
      e.target.value = value;
    });
    document.getElementById("rg").addEventListener("input", function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if(value.length > 2) {
        value = value.replace(/^(\d{2})(\d)/, '$1.$2');
      }
      if(value.length > 5) {
        value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
      }
      if(value.length > 7) {
        value = value.replace(/(\d{2})\.(\d{3})\.(\d{3})(\d{1}).*/, '$1.$2.$3-$4');
      }
      e.target.value = value;
    });

    document.querySelectorAll('.open30kModal').forEach(el => {
      el.addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('modalIntermac30K').style.display = 'block';
      });
    });
    document.querySelectorAll('.open80kModal').forEach(el => {
      el.addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('modalIntermac80K').style.display = 'block';
      });
    });
    document.querySelectorAll('.close-modal').forEach(closeBtn => {
      closeBtn.addEventListener('click', function() {
        const modalId = this.getAttribute('data-close-modal');
        if (modalId) {
          document.getElementById(modalId).style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
