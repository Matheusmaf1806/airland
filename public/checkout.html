<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Checkout Completo</title>

  <!-- Braintree Scripts (oficiais) -->
  <script src="https://js.braintreegateway.com/web/3.94.0/js/client.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.94.0/js/hosted-fields.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.94.0/js/three-d-secure.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.94.0/js/paypal-checkout.min.js"></script>
  <script src="https://js.braintreegateway.com/web/3.94.0/js/google-payment.min.js"></script>

  <style>
    /*********************************************
     * RESET & BASE
     *********************************************/
    @import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap");
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: "Montserrat", sans-serif;
      background: #000e29; /* conforme pedido */
      color: #5d657b;
      font-weight: 400;
    }
    input, select, textarea {
      font-family: "Montserrat", sans-serif;
    }
    a, button {
      cursor: pointer;
      transition: 0.3s;
      text-decoration: none;
    }

    /*********************************************
     * ALERTAS (snippet do usu√°rio)
     *********************************************/
    .container.mt-5 {
      margin-top: 2rem !important;
    }
    .alert>.start-icon {
      margin-right: 5px;
      min-width: 20px;
      text-align: center;
    }
    .greencross { font-size:18px; color: #25ff0b; text-shadow: none; }
    .alert-simple.alert-success {
      border: 1px solid rgba(36, 241, 6, 0.46);
      background-color: rgba(7, 149, 66, 0.12);
      box-shadow: 0px 0px 2px #259c08;
      color: #0ad406;
      text-shadow: 2px 1px #00040a;
      cursor:pointer;
      transition:0.5s;
    }
    .alert-success:hover {
      background-color: rgba(7, 149, 66, 0.35);
    }
    .alert-simple.alert-info {
      border: 1px solid rgba(6, 44, 241, 0.46);
      background-color: rgba(7, 73, 149, 0.12);
      box-shadow: 0px 0px 2px #0396ff;
      color: #0396ff;
      text-shadow: 2px 1px #00040a;
      cursor:pointer;
      transition:0.5s;
    }
    .alert-info:hover {
      background-color: rgba(7, 73, 149, 0.35);
    }
    .blue-cross {
      font-size: 18px; color: #0bd2ff; text-shadow: none;
    }
    .alert-simple.alert-warning {
      border: 1px solid rgba(241, 142, 6, 0.81);
      background-color: rgba(220, 128, 1, 0.16);
      box-shadow: 0px 0px 2px #ffb103;
      color: #ffb103;
      text-shadow: 2px 1px #00040a;
      cursor:pointer;
      transition:0.5s;
    }
    .alert-warning:hover {
      background-color: rgba(220, 128, 1, 0.33);
    }
    .warning {
      font-size: 18px; color: #ffb40b; text-shadow: none;
    }
    .alert-simple.alert-danger {
      border: 1px solid rgba(241, 6, 6, 0.81);
      background-color: rgba(220, 17, 1, 0.16);
      box-shadow: 0px 0px 2px #ff0303;
      color: #ff0303;
      text-shadow: 2px 1px #00040a;
      cursor:pointer;
      transition:0.5s;
    }
    .alert-danger:hover {
      background-color: rgba(220, 17, 1, 0.33);
    }
    .danger {
      font-size: 18px; color: #ff0303; text-shadow: none;
    }
    .alert-simple.alert-primary {
      border: 1px solid rgba(6, 241, 226, 0.81);
      background-color: rgba(1, 204, 220, 0.16);
      box-shadow: 0px 0px 2px #03fff5;
      color: #03d0ff;
      text-shadow: 2px 1px #00040a;
      cursor:pointer;
      transition:0.5s;
    }
    .alert-primary:hover {
      background-color: rgba(1, 204, 220, 0.33);
    }
    .alertprimary {
      font-size: 18px; color: #03d0ff; text-shadow: none;
    }
    .fa-times {
      -webkit-animation: blink-1 2s infinite both;
      animation: blink-1 2s infinite both;
    }
    @-webkit-keyframes blink-1 {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0; }
    }
    @keyframes blink-1 {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0; }
    }

    .square_box {
      position: absolute;
      transform: rotate(45deg);
      border-top-left-radius: 45px;
      opacity: 0.302;
    }
    .square_box.box_three {
      background-image: linear-gradient(-90deg, #290a59 0%, #3d57f4 100%);
      opacity: 0.059;
      left: -80px; top: -60px; width: 500px; height: 500px; border-radius: 45px;
    }
    .square_box.box_four {
      background-image: linear-gradient(-90deg, #290a59 0%, #3d57f4 100%);
      opacity: 0.059;
      left: 150px; top: -25px; width: 550px; height: 550px; border-radius: 45px;
    }

    /*********************************************
     * STEPS MENU
     *********************************************/
    .steps-menu {
      background-color: #365cf5;
      padding: 20px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 30px;
    }
    .steps-menu .step {
      display: flex; align-items: center; gap: 0.5rem; color: #fff; font-weight: 500; cursor: pointer;
    }
    .steps-menu .circle {
      width: 34px; height: 34px; border-radius: 50%; background-color: #fff; color: #365cf5;
      display: flex; align-items: center; justify-content: center; font-weight: 700;
    }
    .steps-menu .separator {
      color: #fff; font-weight: bold;
    }
    .steps-menu .step.active .circle {
      background-color: #fff; color: #365cf5; border: 2px solid #fff;
    }
    .steps-menu .step.disabled { opacity: 0.6; cursor: not-allowed; }

    /*********************************************
     * MAIN LAYOUT
     *********************************************/
    .main-container {
      width: 90%; max-width: 1200px; margin: 2rem auto; display: flex; gap: 2rem;
    }
    .left-col { flex: 1; }
    .right-col {
      width: 400px; flex-shrink: 0;
    }

    .card-style-1 {
      background: #fff; border: 1px solid #efefef; border-radius: 10px;
      padding: 25px 30px; box-shadow: 0px 12px 24px -4px rgba(145,158,171,0.12);
      margin-bottom: 20px; color: #1f2b47;
    }

    .step-content { display: none; }
    .step-content.active { display: block; }

    .navigation { margin-top: 1rem; text-align: right; }
    .btn-save-passenger,
    .btn-pay-pal {
      background: #007aff; color: #fff; border: none; border-radius: 4px;
      padding: 0.75rem 1.5rem; font-size: 0.9rem; cursor: pointer;
    }
    .btn-save-passenger:hover { background: #005dbf; }

    /*********************************************
     * FORM FIELDS
     *********************************************/
    .fields-grid-2cols {
      display: grid; grid-template-columns: repeat(2,1fr); gap: 1rem; margin-bottom: 1rem;
    }
    .fields-grid-3cols {
      display: grid; grid-template-columns: repeat(3,1fr); gap: 1rem; margin-bottom: 1rem;
    }
    .form-field {
      display: flex; flex-direction: column; margin-bottom: 1rem;
    }
    .form-field label {
      font-size: 0.85rem; color: #666; margin-bottom: 0.4rem; font-weight: 500;
    }
    .form-field input,
    .form-field select {
      font-size: 0.85rem; padding: 0.6rem; border: 1px solid #eee; border-radius: 4px;
    }
    .form-field input:focus,
    .form-field select:focus {
      border-color: #007aff;
    }

    .btn-add-passenger {
      display: block; width: 100%; background: #fff; border: 1px solid #dcdcdc; border-radius: 8px;
      padding: 1rem 0; color: #1f2b47; text-align: center; margin: 1rem auto; font-weight: 600; font-size: 1rem;
    }
    .btn-add-passenger:hover {
      background: #f1f5f9; color: #365cf5;
    }

    /*********************************************
     * MODAL: PASSAGEIROS EXTRAS
     *********************************************/
    .modal {
      display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff; margin: 5% auto; padding: 20px 25px; border-radius: 12px;
      width: 90%; max-width: 700px; box-shadow: 0 8px 30px rgba(0,0,0,0.2); position: relative;
      color: #1f2b47;
    }
    .close-modal {
      position: absolute; right: 15px; top: 10px; font-size: 24px; font-weight: bold; cursor: pointer;
    }
    .modal-subtitle {
      font-size: 0.9rem; color: #555; margin-bottom: 1.5rem; line-height: 1.4;
    }
    .passenger-box {
      background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .passenger-box h4 {
      font-size: 1rem; margin-bottom: 0.5rem; color: #333;
    }
    .fields-grid-2cols-modal {
      display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;
    }

    /*********************************************
     * STEP 2: DETALHES (SEGURO)
     *********************************************/
    .insurance-options-container {
      display: grid; grid-template-columns: 1fr; gap: 1rem; margin-top: 1.5rem;
    }
    .insurance-option {
      border: 1px solid #ddd; border-radius: 8px; padding: 1rem; position: relative;
      transition: 0.3s;
    }
    .insurance-option:hover { background: #f9f9f9; }
    .insurance-option input[type="radio"] {
      position: absolute; top: 1rem; right: 1rem; transform: scale(1.3); cursor: pointer;
    }
    .insurance-title {
      font-size: 1rem; font-weight: 600; color: #1f2b47;
    }
    .insurance-price {
      font-size: 1.1rem; font-weight: 700; color: #00c853;
    }
    .insurance-links a {
      color: #365cf5; margin-right: 1rem; text-decoration: none; font-weight: 500;
    }
    .insurance-links a:hover { text-decoration: underline; }
    .insurance-logo {
      max-height: 30px; vertical-align: middle; margin-left: 8px;
    }
    .insurance-separator {
      border-top: 1px dashed #ccc; margin: 0.5rem 0;
    }
    .insurance-features {
      margin-top: 0.5rem; display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.85rem;
    }

    /*********************************************
     * STEP 3: PAGAMENTO
     *********************************************/
    #card-container {
      margin-top: 1rem; background: #fafafa; border: 1px solid #ddd; border-radius: 8px; padding: 1.5rem;
    }
    #card-number, #expiration-date, #cvv {
      display: flex; align-items: center; height: 44px; background: #fff; border: 1px solid #ccc;
      border-radius: 6px; padding: 0 8px; transition: border-color 0.3s;
    }
    #card-number:focus-within, #expiration-date:focus-within, #cvv:focus-within {
      border-color: #007aff;
    }
    #installments {
      width: 100%; border: 1px solid #ccc; border-radius: 6px; padding: 0.4rem; margin-top: 0.2rem;
    }

    #paypal-container,
    #google-pay-container {
      margin-top: 1rem; background: #fafafa; border: 1px solid #ddd; border-radius: 8px; padding: 1rem;
    }

    /*********************************************
     * CARRINHO (COLUNA DIREITA)
     *********************************************/
    .reservation-gifts-card {
      background: #fff; border: 1px solid #efefef; border-radius: 10px; padding: 25px 30px;
      box-shadow: 0px 12px 24px -4px rgba(145,158,171,0.12);
    }
    .reserva-item {
      display: grid; grid-template-columns: auto 1fr auto; gap: 1rem;
      padding: 0.75rem 0; border-bottom: 1px solid #eee; margin-bottom: 0.75rem; align-items: center;
    }
    .resumo-compra {
      margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;
    }

    /*********************************************
     * TABELAS DE COBERTURAS (MODAIS 30K/80K)
     *********************************************/
    .coverage-table {
      width: 100%; border-collapse: collapse; margin-top: 1rem;
    }
    .coverage-table th, .coverage-table td {
      border: 1px solid #ddd; padding: 0.6rem; font-size: 0.85rem; text-align: left;
    }
    .coverage-table thead { background: #f1f5f9; }

    @media (max-width: 768px) {
      .main-container { flex-direction: column; }
      .right-col { width: 100%; }
      .fields-grid-2cols-modal { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- ALERTAS (iniciam ocultos) -->
  <section>
    <div class="square_box box_three"></div>
    <div class="square_box box_four"></div>
    <div class="container mt-5">
      <div class="row">
        <!-- SUCCESS -->
        <div class="col-sm-12" id="alertSuccess" style="display:none;">
          <div class="alert fade alert-simple alert-success alert-dismissible text-left font__family-montserrat font__size-16 font__weight-light show">
            <button type="button" class="close font__size-18" data-dismiss="alert">
              <span aria-hidden="true"><a><i class="fa fa-times greencross"></i></a></span>
              <span class="sr-only">Close</span>
            </button>
            <i class="start-icon far fa-check-circle faa-tada animated"></i>
            <strong class="font__weight-semibold">Tudo Certo!</strong> Passageiros nomeados e salvos com sucesso!
          </div>
        </div>
        <!-- INFO -->
        <div class="col-sm-12" id="alertInfo" style="display:none;">
          <div class="alert fade alert-simple alert-info alert-dismissible text-left font__family-montserrat font__size-16 font__weight-light show" role="alert">
            <button type="button" class="close font__size-18" data-dismiss="alert">
              <span aria-hidden="true"><i class="fa fa-times blue-cross"></i></span>
              <span class="sr-only">Close</span>
            </button>
            <i class="start-icon fa fa-info-circle faa-shake animated"></i>
            <strong class="font__weight-semibold">Verifique!</strong> N√£o foram preenchidos todos os passageiros.
          </div>
        </div>
        <!-- WARNING -->
        <div class="col-sm-12" id="alertWarning" style="display:none;">
          <div class="alert fade alert-simple alert-warning alert-dismissible text-left font__family-montserrat font__size-16 font__weight-light show" role="alert">
            <button type="button" class="close font__size-18" data-dismiss="alert">
              <span aria-hidden="true"><i class="fa fa-times warning"></i></span>
              <span class="sr-only">Close</span>
            </button>
            <i class="start-icon fa fa-exclamation-triangle faa-flash animated"></i>
            <strong class="font__weight-semibold">Aviso!</strong> Preencha o nome dos passageiros clicando no bot√£o "Nomear passageiros (Obrigat√≥rio)".
          </div>
        </div>
        <!-- DANGER -->
        <div class="col-sm-12" id="alertDanger" style="display:none;">
          <div class="alert fade alert-simple alert-danger alert-dismissible text-left font__family-montserrat font__size-16 font__weight-light show" role="alert">
            <button type="button" class="close font__size-18" data-dismiss="alert">
              <span aria-hidden="true"><i class="fa fa-times danger"></i></span>
              <span class="sr-only">Close</span>
            </button>
            <i class="start-icon far fa-times-circle faa-pulse animated"></i>
            <strong class="font__weight-semibold">Aten√ß√£o!</strong> Preencha todos os campos obrigat√≥rios antes de continuar.
          </div>
        </div>
        <!-- PRIMARY -->
        <div class="col-sm-12" id="alertPrimary" style="display:none;">
          <div class="alert fade alert-simple alert-primary alert-dismissible text-left font__family-montserrat font__size-16 font__weight-light show" role="alert">
            <button type="button" class="close font__size-18" data-dismiss="alert">
              <span aria-hidden="true"><i class="fa fa-times alertprimary"></i></span>
              <span class="sr-only">Close</span>
            </button>
            <i class="start-icon fa fa-thumbs-up faa-bounce animated"></i>
            <strong class="font__weight-semibold">Desconto Aplicado!</strong> O seu cupom de desconto foi aplicado com sucesso.
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- FIM ALERTAS -->

  <!-- MENU DE STEPS -->
  <div class="steps-menu" id="stepsMenu">
    <div class="step active" data-step="1">
      <div class="circle">1</div>
      <span>Passageiros</span>
    </div>
    <div class="separator">></div>
    <div class="step" data-step="2">
      <div class="circle">2</div>
      <span>Detalhes</span>
    </div>
    <div class="separator">></div>
    <div class="step" data-step="3">
      <div class="circle">3</div>
      <span>Pagamento</span>
    </div>
    <div class="separator">></div>
    <div class="step" data-step="4">
      <div class="circle">4</div>
      <span>Confirma√ß√£o</span>
    </div>
  </div>

  <!-- CONTAINER PRINCIPAL -->
  <div class="main-container">
    <!-- COLUNA ESQUERDA (STEPS) -->
    <div class="left-col">
      <!-- STEP 1: Passageiro Principal -->
      <div class="step-content active" data-step="1">
        <div class="card-style-1">
          <h2>Passageiro Principal</h2>
          <!-- Link para Login (exibido se n√£o estiver logado) -->
          <div style="text-align: right; margin-bottom: 1rem;">
            <a href="#" id="toggleLogin">Economize tempo fazendo Login</a>
          </div>

          <!-- Formul√°rio de Login / Registro -->
          <div id="topFieldsContainer">
            <!-- Formul√°rio de Login -->
            <div id="loginFields" style="display: none;">
              <div class="fields-grid-2cols">
                <div class="form-field">
                  <label>E-mail *</label>
                  <input type="email" id="loginEmail" placeholder="seuemail@exemplo.com">
                </div>
                <div class="form-field">
                  <label>Senha *</label>
                  <input type="password" id="loginPassword" placeholder="********">
                </div>
              </div>
              <div style="text-align: right; margin-top: 10px;">
                <button class="btn-save-passenger" id="loginValidateBtn">Entrar</button>
              </div>
            </div>

            <!-- Formul√°rio de Registro (Nome, Sobrenome, etc.) -->
            <div id="registrationFieldsGeneral">
              <div class="fields-grid-2cols">
                <div class="form-field">
                  <label>Nome *</label>
                  <input type="text" id="firstName" placeholder="Nome">
                </div>
                <div class="form-field">
                  <label>Sobrenome *</label>
                  <input type="text" id="lastName" placeholder="Sobrenome">
                </div>
              </div>
              <div class="fields-grid-2cols">
                <div class="form-field">
                  <label>Celular *</label>
                  <input type="text" id="celular" placeholder="(XX) 99999-9999">
                </div>
                <div class="form-field">
                  <label>E-mail *</label>
                  <input type="email" id="email" placeholder="seuemail@exemplo.com">
                </div>
              </div>
              <div class="fields-grid-2cols">
                <div class="form-field">
                  <label>Senha *</label>
                  <input type="password" id="password" placeholder="********">
                </div>
                <div class="form-field">
                  <label>Repetir Senha *</label>
                  <input type="password" id="confirmPassword" placeholder="********">
                </div>
              </div>
            </div>
          </div>

          <!-- Campos Documentos/Endere√ßo -->
          <div id="documentFields">
            <div class="fields-grid-3cols">
              <div class="form-field">
                <label>CPF *</label>
                <input type="text" id="cpf" placeholder="123.456.789-00">
              </div>
              <div class="form-field">
                <label>RG *</label>
                <input type="text" id="rg" placeholder="12.345.678-9">
              </div>
              <div class="form-field">
                <label>Data de Nascimento *</label>
                <input type="date" id="birthdate" placeholder="dd/mm/aaaa">
              </div>
            </div>
            <div class="fields-grid-3cols">
              <div class="form-field">
                <label>CEP *</label>
                <input type="text" id="cep" placeholder="12345-678">
              </div>
              <div class="form-field">
                <label>Estado *</label>
                <input type="text" id="state" placeholder="Ex: SP">
              </div>
              <div class="form-field">
                <label>Cidade *</label>
                <input type="text" id="city" placeholder="S√£o Paulo">
              </div>
            </div>
            <div class="fields-grid-2cols">
              <div class="form-field">
                <label>Endere√ßo *</label>
                <input type="text" id="address" placeholder="Rua, Avenida...">
              </div>
              <div class="form-field">
                <label>N√∫mero *</label>
                <input type="text" id="number" placeholder="123">
              </div>
            </div>
          </div>

          <!-- Bot√£o Nomear Passageiros (Abrir Modal) -->
          <button class="btn-add-passenger" id="openPassengerModal">
            Nomear passageiros (Obrigat√≥rio)‚ûï
          </button>

          <p style="font-size:0.75rem; color:#888;">* Insira o nome exatamente como aparece em seus documentos.</p>
          <div class="navigation">
            <button class="btn-save-passenger" id="toStep2">Pr√≥ximo</button>
          </div>
        </div>

        <!-- MODAL PARA PASSAGEIROS EXTRAS -->
        <div id="passengerModal" class="modal">
          <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h3>Passageiros Extras ‚Äì Nomea√ß√£o Obrigat√≥ria</h3>
            <p class="modal-subtitle">
              Nomear todos os passageiros √© essencial para garantir acesso sem imprevistos aos servi√ßos e produtos adquiridos.
              Isso evita restri√ß√µes e assegura uma experi√™ncia segura e tranquila.
            </p>
            <div id="modalPassengerContainer"></div>
            <div style="text-align: right; margin-top: 1rem;">
              <button class="btn-save-passenger" id="savePassengersBtn">Salvar Passageiros</button>
            </div>
          </div>
        </div>
      </div>

      <!-- STEP 2: Detalhes (Seguros) -->
      <div class="step-content" data-step="2">
        <div class="card-style-1">
          <h2>Detalhes Adicionais</h2>
          <p>Selecione o seguro de viagem que deseja adicionar √† sua reserva:</p>

          <div class="insurance-options-container">
            <!-- 1) SEM SEGURO -->
            <label class="insurance-option" data-insurance="none">
              <input type="radio" name="insuranceOption" value="none" />
              <div style="font-weight:600;">Sem Seguro Viagem</div>
              <div style="margin-top:0.5rem; font-size:0.85rem;">
                Vai viajar sem prote√ß√£o?<br>
                Imprevistos podem acontecer, e alguns pa√≠ses exigem seguro viagem na entrada. Garanta o seu antes de embarcar!
              </div>
              <div style="color:#d32f2f; font-weight:600; margin-top:0.25rem;">Op√ß√£o n√£o recomendada</div>
            </label>

            <!-- 2) INTERMAC 30K -->
            <label class="insurance-option" data-insurance="30k">
              <input type="radio" name="insuranceOption" value="30k" />
              <div style="display:flex; align-items:center; gap:0.5rem;">
                <div class="insurance-title">Intermac 30K</div>
                <img src="https://www.intermacseguros.com/bra/includes/logo-intermac-25-anos.png"
                     alt="Logo Intermac"
                     class="insurance-logo">
              </div>
              <div style="font-size:0.9rem; font-weight:500; color:#333;">
                üóìÔ∏è 16 abr. 2025 - 18 abr. 2025
              </div>
              <div class="insurance-price">+ R$ 112,81</div>
              <div class="insurance-separator"></div>
              <div class="insurance-features">
                <span>‚úÖ Cancelamento gr√°tis</span>
                <span>‚úÖ Despesas hospitalares de at√© USD$ 30.000</span>
                <span>‚úÖ Despesas farmac√™uticas de at√© USD$ 500</span>
              </div>
              <div class="insurance-links" style="margin-top:0.5rem;">
                <a href="#" class="open30kModal">Ver mais</a>
                <a href="#" class="open30kModal">Ver pol√≠ticas</a>
              </div>
            </label>

            <!-- 3) INTERMAC 80K -->
            <label class="insurance-option" data-insurance="80k">
              <input type="radio" name="insuranceOption" value="80k" />
              <div style="display:flex; align-items:center; gap:0.5rem;">
                <div class="insurance-title">Intermac 80K</div>
                <img src="https://www.intermacseguros.com/bra/includes/logo-intermac-25-anos.png"
                     alt="Logo Intermac"
                     class="insurance-logo">
              </div>
              <div style="font-size:0.9rem; font-weight:500; color:#333;">
                üóìÔ∏è 16 abr. 2025 - 18 abr. 2025
              </div>
              <div class="insurance-price">+ R$ 212,02</div>
              <div class="insurance-separator"></div>
              <div class="insurance-features">
                <span>‚úÖ Cancelamento gr√°tis</span>
                <span>‚úÖ Despesas hospitalares de at√© USD$ 80.000</span>
                <span>‚úÖ Despesas farmac√™uticas de at√© USD$ 2.000</span>
                <span>‚úÖ Acesso √† Sala Vip em caso de atraso do voo</span>
              </div>
              <div class="insurance-links" style="margin-top:0.5rem;">
                <a href="#" class="open80kModal">Ver mais</a>
                <a href="#" class="open80kModal">Ver pol√≠ticas</a>
              </div>
            </label>
          </div>

          <div class="navigation">
            <button class="btn-save-passenger" id="backToStep1">Voltar</button>
            <button class="btn-save-passenger" id="toStep3">Pr√≥ximo</button>
          </div>
        </div>
      </div>

      <!-- STEP 3: Pagamento -->
      <div class="step-content" data-step="3">
        <div class="card-style-1">
          <h2>Pagamento</h2>
          <p style="margin-bottom:1rem;">Escolha o m√©todo de pagamento abaixo.</p>

          <div class="form-field">
            <label>M√©todo de Pagamento</label>
            <div>
              <input type="radio" id="methodCard" name="paymentMethod" value="card" checked />
              <label for="methodCard">Cart√£o de Cr√©dito</label>
              <input type="radio" id="methodPayPal" name="paymentMethod" value="paypal" />
              <label for="methodPayPal">PayPal</label>
              <input type="radio" id="methodGooglePay" name="paymentMethod" value="googlePay" />
              <label for="methodGooglePay">Google Pay</label>
            </div>
          </div>

          <div id="card-container" style="display:block;">
            <div class="form-field">
              <label>Parcelas</label>
              <select id="installments">
                <option value="1">1x</option>
                <option value="2">2x</option>
                <option value="3">3x</option>
                <option value="4">4x</option>
                <option value="5">5x</option>
                <option value="6">6x</option>
                <option value="7">7x</option>
                <option value="8">8x</option>
                <option value="9">9x</option>
                <option value="10">10x</option>
              </select>
            </div>
            <form id="checkout-form">
              <div class="form-field">
                <label>N√∫mero do Cart√£o</label>
                <div id="card-number" style="border:1px solid #ccc; padding:10px;"></div>
              </div>
              <div class="fields-grid-2cols">
                <div class="form-field">
                  <label>Data de Expira√ß√£o (MM/AA)</label>
                  <div id="expiration-date" style="border:1px solid #ccc; padding:10px;"></div>
                </div>
                <div class="form-field">
                  <label>CVV</label>
                  <div id="cvv" style="border:1px solid #ccc; padding:10px;"></div>
                </div>
              </div>
              <button type="submit" class="btn-pay-pal">Pagar</button>
            </form>
          </div>

          <div id="paypal-container" style="display:none;">
            <div id="paypal-button-container"></div>
          </div>
          <div id="google-pay-container" style="display:none;">
            <div id="google-pay-button-container"></div>
          </div>

          <div class="navigation">
            <button class="btn-save-passenger" id="backToStep2">Voltar</button>
          </div>
        </div>
      </div>

      <!-- STEP 4: Confirma√ß√£o -->
      <div class="step-content" data-step="4">
        <div class="card-style-1">
          <h2>Pagamento Conclu√≠do</h2>
          <p>Seu pagamento foi efetuado com sucesso!</p>
          <p>Obrigado por sua compra.</p>
        </div>
      </div>
    </div>

    <!-- COLUNA DIREITA: Resumo do Carrinho -->
    <div class="right-col">
      <div class="card-style-1 reservation-gifts-card">
        <h2>Informa√ß√µes da Reserva</h2>
        <div id="cartItemsList"></div>
        <div class="resumo-compra">
          <div class="form-field cupom" style="display:flex; gap:0.5rem;">
            <input type="text" id="couponInput" placeholder="Insira seu cupom" style="flex:1;">
            <button class="btn-save-passenger" id="applyCouponBtn" style="padding:0.5rem 1rem;">Aplicar Cupom</button>
          </div>
          <div class="resumo-row" style="display:flex; justify-content:space-between; margin-top:0.5rem;">
            <label>Subtotal</label>
            <p id="subtotalValue">R$ 0,00</p>
          </div>
          <div class="resumo-row" style="display:flex; justify-content:space-between;">
            <label>Desconto</label>
            <p id="discountValue">- R$ 0,00</p>
          </div>
          <div class="resumo-row total-line" style="display:flex; justify-content:space-between; margin-top:0.5rem;">
            <label>Total do Pedido</label>
            <p id="totalValue">R$ 0,00</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer style="width:90%; max-width:1200px; margin:2rem auto; text-align:center; color:#fff;">
    ¬© 2025 - Checkout Trip.com (Completo)
  </footer>

  <!-- MODAL: Coberturas Intermac 30K -->
  <div class="modal" id="modalIntermac30K">
    <div class="modal-content">
      <span class="close-modal" data-close-modal="modalIntermac30K">&times;</span>
      <h3>Intermac 30K ‚Äì Coberturas</h3>
      <table class="coverage-table">
        <thead>
          <tr><th>Coberturas</th><th>Valores</th></tr>
        </thead>
        <tbody>
          <tr><td>Despesas Emergenciais M√©dicas e Hospitalares em Viagem Internacional</td><td>$30,000.00</td></tr>
          <tr><td>Despesas Emergenciais Odontol√≥gicas</td><td>$200.00</td></tr>
          <tr><td>Prote√ß√£o COVID-19 Integral</td><td>INCLUSO NO DMH</td></tr>
          <tr><td>Despesas Farmac√™uticas</td><td>$150.00</td></tr>
          <tr><td>Remo√ß√£o M√©dica</td><td>$20,000.00</td></tr>
          <tr><td>Repatria√ß√£o M√©dica</td><td>$20,000.00</td></tr>
          <tr><td>Repatria√ß√£o Funer√°ria</td><td>$20,000.00</td></tr>
          <tr><td>Prorroga√ß√£o de Estadia</td><td>$375.00</td></tr>
          <tr><td>Retorno de Menores</td><td>$1,500.00</td></tr>
          <tr><td>Retorno do Segurado</td><td>$1,500.00</td></tr>
          <tr><td>Hospedagem de Acompanhante</td><td>$375.00</td></tr>
          <tr><td>Acompanhante em Caso de Hospitaliza√ß√£o Prolongada</td><td>$1,500.00</td></tr>
          <tr><td>Despesas Jur√≠dicas</td><td>$1,000.00</td></tr>
          <tr><td>Fian√ßa e Despesas Legais</td><td>$1,500.00</td></tr>
          <tr><td>Cancelamento de Viagem</td><td>$500.00</td></tr>
          <tr><td>Perda ou Roubo de Bagagem</td><td>$350.00</td></tr>
          <tr><td>Invalidez Permanente Total ou Parcial por Acidente</td><td>$7,500.00</td></tr>
          <tr><td>Morte Acidental</td><td>$7,500.00</td></tr>
          <tr><td>Interrup√ß√£o de Viagem</td><td>N/A</td></tr>
          <tr><td>Atraso de Bagagem (depois de 12h)</td><td>$100.00</td></tr>
          <tr><td>Atraso de V√¥o</td><td>$100.00</td></tr>
          <tr><td>Gravidez at√© 28 semanas</td><td>INCLUSO NO DMH</td></tr>
          <tr><td>Esporte a Lazer e Amador</td><td>INCLUSO NO DMH</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- MODAL: Coberturas Intermac 80K -->
  <div class="modal" id="modalIntermac80K">
    <div class="modal-content">
      <span class="close-modal" data-close-modal="modalIntermac80K">&times;</span>
      <h3>Intermac 80K ‚Äì Coberturas</h3>
      <table class="coverage-table">
        <thead>
          <tr><th>Coberturas</th><th>Valores</th></tr>
        </thead>
        <tbody>
          <tr><td>Despesas Emergenciais M√©dicas e Hospitalares em Viagem Internacional</td><td>$80,000.00</td></tr>
          <tr><td>Despesas Emergenciais Odontol√≥gicas</td><td>$800.00</td></tr>
          <tr><td>Prote√ß√£o COVID-19 Integral</td><td>INCLUSO NO DMH</td></tr>
          <tr><td>Despesas Farmac√™uticas</td><td>$800.00</td></tr>
          <tr><td>Remo√ß√£o M√©dica</td><td>$50,000.00</td></tr>
          <tr><td>Repatria√ß√£o M√©dica</td><td>$50,000.00</td></tr>
          <tr><td>Repatria√ß√£o Funer√°ria</td><td>$50,000.00</td></tr>
          <tr><td>Prorroga√ß√£o de Estadia</td><td>$5,000.00</td></tr>
          <tr><td>Retorno de Menores</td><td>$1,500.00</td></tr>
          <tr><td>Retorno do Segurado</td><td>$1,500.00</td></tr>
          <tr><td>Hospedagem de Acompanhante</td><td>$500.00</td></tr>
          <tr><td>Acompanhante em Caso de Hospitaliza√ß√£o Prolongada</td><td>$1,500.00</td></tr>
          <tr><td>Despesas Jur√≠dicas</td><td>$1,600.00</td></tr>
          <tr><td>Fian√ßa e Despesas Legais</td><td>$5,000.00</td></tr>
          <tr><td>Cancelamento de Viagem</td><td>$1,250.00</td></tr>
          <tr><td>Perda ou Roubo de Bagagem</td><td>$750.00</td></tr>
          <tr><td>Invalidez Permanente Total ou Parcial por Acidente</td><td>$17,500.00</td></tr>
          <tr><td>Morte Acidental</td><td>$17,500.00</td></tr>
          <tr><td>Interrup√ß√£o de Viagem</td><td>$750.00</td></tr>
          <tr><td>Atraso de Bagagem (depois de 12h)</td><td>$250.00</td></tr>
          <tr><td>Atraso de V√¥o</td><td>$250.00</td></tr>
          <tr><td>Gravidez at√© 28 semanas</td><td>INCLUSO NO DMH</td></tr>
          <tr><td>Esporte a Lazer e Amador</td><td>INCLUSO NO DMH</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- (Opcional) Shopping Cart oculto, se quiser usar -->
  <shopping-cart id="shoppingCart" style="display:none;"></shopping-cart>

  <script>
    /*********************************************
     * OBJETO GLOBAL
     *********************************************/
    let checkoutData = {
      extraPassengers: [],   // array de arrays, para passageiros extras de cada item
      insuranceSelected: "none",
      discount: 0
    };

    // Exemplo de itens do carrinho
    let cartItems = [
      {
        hotelName: "Hotel Exemplo A",
        adults: 2,
        children: 1,
        basePriceAdult: 100,
        checkIn: "2025-04-16",
        checkOut: "2025-04-18"
      },
      {
        hotelName: "Hotel Exemplo B",
        adults: 3,
        children: 0,
        basePriceAdult: 150,
        checkIn: "2025-05-01",
        checkOut: "2025-05-05"
      }
    ];

    /*********************************************
     * FUN√á√ïES DE ALERT
     *********************************************/
    function showAlert(type) {
      // Oculta todos
      document.getElementById("alertSuccess").style.display = "none";
      document.getElementById("alertInfo").style.display = "none";
      document.getElementById("alertWarning").style.display = "none";
      document.getElementById("alertDanger").style.display = "none";
      document.getElementById("alertPrimary").style.display = "none";

      // Exibe apenas o solicitado
      if (type === "success") {
        document.getElementById("alertSuccess").style.display = "block";
      } else if (type === "info") {
        document.getElementById("alertInfo").style.display = "block";
      } else if (type === "warning") {
        document.getElementById("alertWarning").style.display = "block";
      } else if (type === "danger") {
        document.getElementById("alertDanger").style.display = "block";
      } else if (type === "primary") {
        document.getElementById("alertPrimary").style.display = "block";
      }
    }

    /*********************************************
     * MONTAR CARRINHO NA COLUNA DIREITA
     *********************************************/
    function updateCheckoutCart() {
      const container = document.getElementById("cartItemsList");
      container.innerHTML = "";
      let subtotal = 0;

      cartItems.forEach((item, i) => {
        let price = item.basePriceAdult || 80;
        subtotal += price;
        container.innerHTML += `
          <div class="reserva-item">
            <div>
              <strong>${item.hotelName}</strong><br>
              Check-in: ${item.checkIn}<br>
              Check-out: ${item.checkOut}<br>
              Adultos: ${item.adults} | Crian√ßas: ${item.children}
            </div>
            <div style="font-weight:700; color:#00c853;">
              R$ ${price.toFixed(2)}
            </div>
          </div>
        `;
      });

      // Somar valor do seguro
      if (checkoutData.insuranceSelected === "30k") {
        subtotal += 112.81;
      } else if (checkoutData.insuranceSelected === "80k") {
        subtotal += 212.02;
      }

      // Subtrair desconto
      const total = subtotal - (checkoutData.discount || 0);

      document.getElementById("subtotalValue").textContent = "R$ " + subtotal.toFixed(2);
      document.getElementById("discountValue").textContent = "- R$ " + (checkoutData.discount || 0).toFixed(2);
      document.getElementById("totalValue").textContent = "R$ " + total.toFixed(2);
    }

    function getOrderAmount() {
      // L√™ o valor do #totalValue
      let totalText = document.getElementById("totalValue").textContent || "0";
      return parseFloat(totalText.replace("R$", "").replace(",", ".").trim()) || 0;
    }

    /*********************************************
     * VERIFICA CAMPOS OBRIGAT√ìRIOS (PASSAGEIRO PRINCIPAL)
     *********************************************/
    function isMainPassengerFilled() {
      const requiredIds = ["firstName","lastName","cpf","rg","birthdate","cep","state","city","address","number","celular","email"];
      for (let id of requiredIds) {
        const val = (document.getElementById(id)?.value || "").trim();
        if (!val) return false;
      }
      return true;
    }

    /*********************************************
     * VERIFICA PASSAGEIROS EXTRAS
     *********************************************/
    function areAllExtraPassengersFilled() {
      // Para cada item, se (adults>1), precisamos de (adults-1) extras
      for (let i=0; i<cartItems.length; i++) {
        const item = cartItems[i];
        const extraCount = (item.adults || 1) - 1;
        if (extraCount > 0) {
          if (!checkoutData.extraPassengers[i] || checkoutData.extraPassengers[i].length < extraCount) {
            return false;
          }
          for (let j=0; j<extraCount; j++) {
            const passObj = checkoutData.extraPassengers[i][j];
            if (!passObj || !passObj.name || !passObj.birthdate) {
              return false;
            }
          }
        }
      }
      return true;
    }

    /*********************************************
     * MULTI-STEP
     *********************************************/
    const stepContents = document.querySelectorAll(".step-content");
    const stepButtons = document.querySelectorAll(".step");

    function showStep(stepNumber) {
      stepContents.forEach(content => {
        content.classList.toggle("active", content.dataset.step === String(stepNumber));
      });
      stepButtons.forEach(button => {
        const btnStep = parseInt(button.dataset.step, 10);
        button.classList.toggle("active", btnStep === stepNumber);
        if (btnStep > stepNumber) {
          button.classList.add("disabled");
        } else {
          button.classList.remove("disabled");
        }
      });
    }

    const toStep2Btn = document.getElementById("toStep2");
    const backToStep1Btn = document.getElementById("backToStep1");
    const toStep3Btn = document.getElementById("toStep3");
    const backToStep2Btn = document.getElementById("backToStep2");

    toStep2Btn.addEventListener("click", () => {
      // 1) Verificar campos obrigat√≥rios
      if (!isMainPassengerFilled()) {
        showAlert("danger");
        return;
      }
      // 2) Se h√° extras, verificar se j√° foram preenchidos
      const anyExtra = cartItems.some(item => (item.adults || 1) > 1);
      if (anyExtra) {
        // se sequer abriu o modal
        if (!checkoutData.extraPassengers || checkoutData.extraPassengers.length === 0) {
          showAlert("warning");
          return;
        }
        // se abriu, mas n√£o preencheu todos
        if (!areAllExtraPassengersFilled()) {
          showAlert("info");
          return;
        }
      }
      // Tudo certo, vai step 2
      showStep(2);
    });
    backToStep1Btn.addEventListener("click", () => {
      showStep(1);
    });
    toStep3Btn.addEventListener("click", () => {
      // Ver qual seguro foi selecionado
      const selectedInsurance = document.querySelector('input[name="insuranceOption"]:checked');
      if (selectedInsurance) {
        checkoutData.insuranceSelected = selectedInsurance.value;
      } else {
        checkoutData.insuranceSelected = "none";
      }
      updateCheckoutCart();
      showStep(3);
      initializePaymentMethod();
    });
    backToStep2Btn.addEventListener("click", () => {
      showStep(2);
    });

    /*********************************************
     * MODAL PASSAGEIROS EXTRAS
     *********************************************/
    const passengerModal = document.getElementById("passengerModal");
    const openPassengerModalBtn = document.getElementById("openPassengerModal");
    const closeModalBtn = document.getElementById("closeModal");
    const savePassengersBtn = document.getElementById("savePassengersBtn");
    const modalPassengerContainer = document.getElementById("modalPassengerContainer");

    openPassengerModalBtn.addEventListener("click", e => {
      e.preventDefault();
      createModalPassengerForms();
      passengerModal.style.display = "block";
    });
    closeModalBtn.addEventListener("click", () => {
      passengerModal.style.display = "none";
    });

    function createModalPassengerForms() {
      modalPassengerContainer.innerHTML = "";
      checkoutData.extraPassengers = []; // zera
      cartItems.forEach((item, index) => {
        const extraCount = (item.adults || 1) - 1;
        if (extraCount > 0) {
          checkoutData.extraPassengers[index] = [];
          const itemDiv = document.createElement("div");
          itemDiv.classList.add("passenger-box");
          itemDiv.innerHTML = `<h4>${item.hotelName}</h4>`;
          for (let i=0; i<extraCount; i++) {
            itemDiv.innerHTML += `
              <div class="fields-grid-2cols-modal">
                <div class="form-field">
                  <label>Nome do Passageiro #${i+1}</label>
                  <input type="text" placeholder="Nome completo" data-item-index="${index}" data-passenger-index="${i}" class="modalExtraNameInput" />
                </div>
                <div class="form-field">
                  <label>Data de Nascimento</label>
                  <input type="date" data-item-index="${index}" data-passenger-index="${i}" class="modalExtraBirthdateInput" />
                </div>
              </div>
            `;
            // inicializa
            checkoutData.extraPassengers[index][i] = { name: "", birthdate: "" };
          }
          modalPassengerContainer.appendChild(itemDiv);
        }
      });
    }

    // Listener p/ inputs no modal
    modalPassengerContainer.addEventListener("input", e => {
      if (e.target.classList.contains("modalExtraNameInput") || e.target.classList.contains("modalExtraBirthdateInput")) {
        const itemIndex = parseInt(e.target.getAttribute("data-item-index"));
        const passIndex = parseInt(e.target.getAttribute("data-passenger-index"));
        if (!checkoutData.extraPassengers[itemIndex]) {
          checkoutData.extraPassengers[itemIndex] = [];
        }
        if (!checkoutData.extraPassengers[itemIndex][passIndex]) {
          checkoutData.extraPassengers[itemIndex][passIndex] = {};
        }
        if (e.target.classList.contains("modalExtraNameInput")) {
          checkoutData.extraPassengers[itemIndex][passIndex].name = e.target.value;
        } else {
          checkoutData.extraPassengers[itemIndex][passIndex].birthdate = e.target.value;
        }
      }
    });

    savePassengersBtn.addEventListener("click", () => {
      if (!areAllExtraPassengersFilled()) {
        showAlert("info");
      } else {
        showAlert("success");
      }
      passengerModal.style.display = "none";
    });

    /*********************************************
     * CUPOM DE DESCONTO
     *********************************************/
    const applyCouponBtn = document.getElementById("applyCouponBtn");
    applyCouponBtn.addEventListener("click", () => {
      const couponValue = (document.getElementById("couponInput")?.value || "").trim();
      if (couponValue.toUpperCase() === "DESCONTO10") {
        checkoutData.discount = 10;
        showAlert("primary");
      } else {
        checkoutData.discount = 0;
      }
      updateCheckoutCart();
    });

    /*********************************************
     * PAGAMENTO (BRAINTREE)
     *********************************************/
    function initializePaymentMethod() {
      const method = document.querySelector('input[name="paymentMethod"]:checked').value;
      document.getElementById("card-container").style.display = "none";
      document.getElementById("paypal-container").style.display = "none";
      document.getElementById("google-pay-container").style.display = "none";

      if (method === "card") {
        document.getElementById("card-container").style.display = "block";
        initializeBraintreeCard();
      } else if (method === "paypal") {
        document.getElementById("paypal-container").style.display = "block";
        initializePayPal();
      } else if (method === "googlePay") {
        document.getElementById("google-pay-container").style.display = "block";
        initializeGooglePay();
      }
    }

    async function initializeBraintreeCard() {
      // Exemplo: busque token no seu backend
      // Aqui, vamos simular um token fict√≠cio
      let clientToken = ""; 
      // Em produ√ß√£o, fa√ßa algo como:
      // const res = await fetch("/api/braintree/get-client-token");
      // const data = await res.json();
      // clientToken = data.clientToken;

      // Para DEMO, insira um clientToken sandbox real, se quiser testar de fato
      clientToken = "SUA_CLIENT_TOKEN_SANDBOX_AQUI";

      braintree.client.create({ authorization: clientToken }, (clientErr, clientInstance) => {
        if (clientErr) {
          console.error("Erro ao criar Braintree client:", clientErr);
          alert("Erro na inicializa√ß√£o do pagamento.");
          return;
        }
        braintree.threeDSecure.create({ version: 2, client: clientInstance }, (threeDSErr, threeDSecureInstance) => {
          if (threeDSErr) {
            console.error("Erro ao criar 3D Secure:", threeDSErr);
            alert("Erro na inicializa√ß√£o do 3D Secure.");
            return;
          }
          braintree.hostedFields.create({
            client: clientInstance,
            styles: {
              input: { "font-size": "16px", color: "#333" },
              "input.invalid": { color: "red" },
              "input.valid": { color: "green" }
            },
            fields: {
              number: { selector: "#card-number", placeholder: "N√∫mero do Cart√£o" },
              cvv: { selector: "#cvv", placeholder: "CVV" },
              expirationDate: { selector: "#expiration-date", placeholder: "MM/AA" }
            }
          }, (hostedFieldsErr, hostedFieldsInstance) => {
            if (hostedFieldsErr) {
              console.error("Erro ao criar Hosted Fields:", hostedFieldsErr);
              alert("Erro ao configurar os campos de pagamento.");
              return;
            }
            const form = document.getElementById("checkout-form");
            form.addEventListener("submit", evt => {
              evt.preventDefault();
              hostedFieldsInstance.tokenize((tokenizeErr, payload) => {
                if (tokenizeErr) {
                  console.error("Erro ao tokenizar:", tokenizeErr);
                  alert("Erro ao processar dados do cart√£o.");
                  return;
                }
                const amount = getOrderAmount();
                if (!payload.details || !payload.details.bin) {
                  alert("Erro: BIN do cart√£o n√£o dispon√≠vel.");
                  return;
                }
                threeDSecureInstance.verifyCard({
                  nonce: payload.nonce,
                  amount: amount,
                  bin: payload.details.bin,
                  onLookupComplete: (data, next) => { next(); }
                }, (verifyErr, threeDSecurePayload) => {
                  if (verifyErr) {
                    console.error("Erro 3D Secure:", verifyErr);
                    alert("Erro na verifica√ß√£o 3D Secure.");
                    return;
                  }
                  // Se chegou aqui, nonce final = threeDSecurePayload.nonce
                  processPayment(threeDSecurePayload.nonce, "card");
                });
              });
            });
          });
        });
      });
    }

    function initializePayPal() {
      // L√≥gica similar: obtem token, cria PayPal instance, renderiza bot√£o
      console.log("PayPal init (exemplo).");
    }
    function initializeGooglePay() {
      // L√≥gica similar: obtem token, cria GooglePay instance, etc.
      console.log("Google Pay init (exemplo).");
    }

    async function processPayment(nonce, method) {
      // Monta body e envia para o backend
      const amount = getOrderAmount();
      const installments = document.getElementById("installments")?.value || "1";

      const body = {
        paymentMethodNonce: nonce,
        amount: amount,
        installments: installments,
        customer: {
          firstName: document.getElementById("firstName").value,
          lastName: document.getElementById("lastName").value,
          email: document.getElementById("email").value,
          phone: document.getElementById("celular").value
        },
        billing: {
          streetAddress: document.getElementById("address").value,
          extendedAddress: document.getElementById("number").value,
          locality: document.getElementById("city").value,
          region: document.getElementById("state").value,
          postalCode: document.getElementById("cep").value,
          countryCodeAlpha2: "BR"
        },
        extraPassengers: checkoutData.extraPassengers,
        insuranceSelected: checkoutData.insuranceSelected
      };

      // Em produ√ß√£o, fa√ßa algo como:
      // const res = await fetch("/api/braintree/create-transaction", { ... });
      // const result = await res.json();
      // if (result.success) { showStep(4); } else { alert("Erro no pagamento"); }

      // DEMO:
      alert("Pagamento simulado com nonce: " + nonce + "\nValor: R$" + amount);
      showStep(4);
    }

    /*********************************************
     * M√ÅSCARAS & CEP
     *********************************************/
    document.getElementById("cpf").addEventListener("input", function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if(value.length > 3) {
        value = value.replace(/^(\d{3})(\d)/, '$1.$2');
      }
      if(value.length > 6) {
        value = value.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
      }
      if(value.length > 9) {
        value = value.replace(/(\d{3})\.(\d{3})\.(\d{3})(\d{1,2}).*/, '$1.$2.$3-$4');
      }
      e.target.value = value;
    });
    document.getElementById("rg").addEventListener("input", function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if(value.length > 2) {
        value = value.replace(/^(\d{2})(\d)/, '$1.$2');
      }
      if(value.length > 5) {
        value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
      }
      if(value.length > 7) {
        value = value.replace(/(\d{2})\.(\d{3})\.(\d{3})(\d{1}).*/, '$1.$2.$3-$4');
      }
      e.target.value = value;
    });
    document.getElementById("cep").addEventListener("blur", function() {
      let cep = this.value.replace(/\D/g, '');
      if (cep.length === 8) {
        fetch(`https://viacep.com.br/ws/${cep}/json/`)
          .then(r => r.json())
          .then(data => {
            if (!data.erro) {
              document.getElementById("address").value = data.logradouro || "";
              document.getElementById("city").value = data.localidade || "";
              document.getElementById("state").value = data.uf || "";
            }
          });
      }
    });

    /*********************************************
     * LOGIN / REGISTRO
     *********************************************/
    const toggleLoginLink = document.getElementById("toggleLogin");
    const registrationFieldsGeneral = document.getElementById("registrationFieldsGeneral");
    const loginFields = document.getElementById("loginFields");
    toggleLoginLink.addEventListener("click", e => {
      e.preventDefault();
      if (registrationFieldsGeneral.style.display !== "none") {
        registrationFieldsGeneral.style.display = "none";
        loginFields.style.display = "block";
        toggleLoginLink.textContent = "N√£o tenho Login";
      } else {
        registrationFieldsGeneral.style.display = "block";
        loginFields.style.display = "none";
        toggleLoginLink.textContent = "Economize tempo fazendo Login";
      }
    });
    const loginValidateBtn = document.getElementById("loginValidateBtn");
    loginValidateBtn.addEventListener("click", () => {
      const email = document.getElementById("loginEmail").value.trim();
      const pass = document.getElementById("loginPassword").value.trim();
      if (!email || !pass) {
        alert("Preencha e-mail e senha!");
        return;
      }
      // Exemplo: requisi√ß√£o de login
      alert("Login fake. Em produ√ß√£o, chamar backend. Se OK, ocultar campos e exibir step.");
      registrationFieldsGeneral.style.display = "none";
      loginFields.style.display = "none";
      toggleLoginLink.style.display = "none";
    });

    /*********************************************
     * ABRIR MODAIS (VER MAIS) 30K / 80K
     *********************************************/
    document.querySelectorAll(".open30kModal").forEach(el => {
      el.addEventListener("click", e => {
        e.preventDefault();
        document.getElementById("modalIntermac30K").style.display = "block";
      });
    });
    document.querySelectorAll(".open80kModal").forEach(el => {
      el.addEventListener("click", e => {
        e.preventDefault();
        document.getElementById("modalIntermac80K").style.display = "block";
      });
    });
    document.querySelectorAll(".close-modal").forEach(btn => {
      btn.addEventListener("click", function() {
        const modalId = this.getAttribute("data-close-modal");
        if (modalId) {
          document.getElementById(modalId).style.display = "none";
        } else {
          // ou se for o X do modal principal de passageiros
          this.parentElement.parentElement.style.display = "none";
        }
      });
    });

    /*********************************************
     * ON LOAD
     *********************************************/
    window.addEventListener("load", () => {
      updateCheckoutCart();
      showStep(1); // come√ßa no step 1
    });
  </script>
</body>
</html>
