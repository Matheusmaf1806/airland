<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Busca de Hotéis</title>
  <style>
    /* Estilos básicos */
    body { font-family: sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 0 auto; background: #fff; padding: 16px; }
    input, select { padding: 6px; }
    label { display: block; margin-top: 12px; }
    button { margin-top: 12px; padding: 10px 16px; background: #0068ef; color: #fff; border: none; }
    #result { margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Busca de Hotéis</h1>

    <label>Check-in:
      <input type="date" id="checkIn" value="2025-03-21" />
    </label>
    <label>Check-out:
      <input type="date" id="checkOut" value="2025-03-22" />
    </label>
    <label>Adults:
      <input type="number" id="adults" value="1" />
    </label>
    <label>Children:
      <input type="number" id="children" value="0" />
    </label>
    <label>Rooms:
      <input type="number" id="rooms" value="1" />
    </label>
    <label>Age of Adult:
      <input type="number" id="age" value="30" />
    </label>
    <button id="btnSearch">Buscar</button>

    <div id="result"></div>
  </div>

  <script>
    document.getElementById('btnSearch').addEventListener('click', async () => {
      const checkIn = document.getElementById('checkIn').value;
      const checkOut = document.getElementById('checkOut').value;
      const adults = parseInt(document.getElementById('adults').value);
      const children = parseInt(document.getElementById('children').value);
      const rooms = parseInt(document.getElementById('rooms').value);
      const age = parseInt(document.getElementById('age').value);

      // Montar o body exatamente igual ao que funcionou no Postman
      const bodyData = {
        stay: {
          checkIn: checkIn,
          checkOut: checkOut,
          allowOnlyShift: true
        },
        occupancies: [
          {
            adults: adults,
            children: children,
            rooms: rooms,
            paxes: [
              { type: "AD", age: age }
            ]
          }
        ],
        hotels: {
          hotel: [234673, 897496, 89413, 13204, 52174, 989016],
          included: "true",
          type: "HOTELBEDS"
        },
        platform: 80,
        language: "CAS" // se no Postman é CAS
      };

      try {
        const resp = await fetch('https://airland.com.br/search.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(bodyData)
        });

        if (!resp.ok) {
          throw new Error(`HTTP error! status: ${resp.status}`);
        }

        const data = await resp.json();
        console.log('RESPOSTA:', data);

        const resultDiv = document.getElementById('result');
        if (data.error) {
          resultDiv.textContent = `Erro: ${data.error}`;
          return;
        }

        if (Array.isArray(data) && data.length > 0) {
          // É o array de hotéis processado
          let html = '<ul>';
          data.forEach(h => {
            html += `<li>${h.name} - R$ ${h.finalPrice.toFixed(2)}</li>`;
          });
          html += '</ul>';
          resultDiv.innerHTML = html;
        } else if (data.hotels && data.hotels.hotels) {
          // Caso você esteja retornando o JSON cru da Hotelbeds
          resultDiv.textContent = JSON.stringify(data, null, 2);
        } else {
          resultDiv.textContent = 'Nenhum hotel encontrado.';
        }

      } catch (error) {
        console.error(error);
        document.getElementById('result').textContent = `Erro: ${error.message}`;
      }
    });
  </script>
</body>
</html>
